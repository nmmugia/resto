define(["jquery","jquery-ui","bootstrap"],function(a,b){return{nodeUrl:a("#node_url").val(),baseUrl:a("#base_url").val(),socket:!1,isChangeTable:!1,isSelectTableFirst:!1,isSelectTableSecond:!1,firstTableId:"",secondTableId:"",statusTable:"",loadingOverlay:a("#cover"),userId:a("#user_id").val(),groupId:a("#group_id").val(),groupName:a("#group_name").val(),userName:a("#user_name").val(),init:function(){console.log("App Table inited.."),AppTable.loadingOverlay.show();try{AppTable.initSocketIO()}catch(b){AppTable.loadingOverlay.hide(),a("#server-error-message").dialog({dialogClass:"no-close",modal:!0,closeOnEscape:!1,buttons:{Reload:function(){window.location.reload(!0)}}})}},initSocketIO:function(){AppTable.socket=io(AppTable.nodeUrl,{reconnectionAttempts:2}),AppTable.socket.on("reconnect_failed",function(){AppTable.loadingOverlay.hide(),a("#server-error-message").dialog({dialogClass:"no-close",modal:!0,closeOnEscape:!1,buttons:{Reload:function(){window.location.reload(!0)}}})}),AppTable.socket.on("connected",function(b){console.log("Socket.IO connected"),AppTable.socket.emit("cm_auth",{nip:AppTable.userId,name:AppTable.userName,role:AppTable.groupId,role_name:AppTable.groupName}),AppTable.socket.on("sm_auth",function(a){AppTable.loadingOverlay.hide(),AppTable.initUIEvent()}),AppTable.socket.on("sm_notify_new_order",function(b){var c=a("#tab_layout_"+b.table_id),d='<p class="table-name">'+b.status_name+'</p><p class= "table-status" >'+b.table_status+'</p><input type = "hidden" id = "table_id_selected" value = "'+b.table_id+'" /><input type = "hidden" id = "number_guest_selected" value = "'+b.number_guest+'" /><input type = "hidden" id = "table_status_selected" value = "'+b.table_status+'" /><input type = "hidden" id = "order_id_selected" value = "'+b.order_id+'" /> ';c.removeClass().addClass("table-list table2 status-"+b.status_name),c.html(d)})})},initUIEvent:function(){a(document).on("click",".table-list",function(){var b=a(this).children(),c=a(b[1]).text();if(0==AppTable.isChangeTable)if(1==c){for(i=1;i<13;i++)a(".table_id_"+i).val(a(b[2]).val());a("#new_table_id").val(a(b[2]).val()),a("#order_id_hidden").val(a(b[5]).val()),a(".popup-block").show()}else a("#table_id_hidden").val(a(b[2]).val()),a("#number_guest_hidden").val(a(b[3]).val()),a("#table_status_hidden").val(a(b[4]).val()),a("#order_id_hidden").val(a(b[5]).val()),a(".btn-hidden").click();else AppTable.isSelectTableFirst?(console.log("first choose"),1!=c?(AppTable.firstTableId=a(b[2]).val(),AppTable.statusTable=a(b[4]).val(),AppTable.isSelectTableFirst=!1,a(".table-container").find(".status-completed").css("background-color","red"),a(".table-container").find(".status-order").css("background-color","red"),a(".table-container").find(".status-waiting").css("background-color","red"),a(".table-container").find(".status-empty").css("background-color","")):(console.log("table empty"),AppTable.isSelectTableFirst=!0)):(console.log("second choose"),1==c?(AppTable.secondTableId=a(b[2]).val(),AppTable.loadingOverlay.show(),a.ajax({type:"POST",url:AppTable.baseUrl+"table/change_table",data:{first_table:AppTable.firstTableId,second_table:AppTable.secondTableId,status_table:AppTable.statusTable}}).done(function(b){if(""!=b){var c=JSON.parse(b);c.status===!0?(console.log(c),AppTable.socket.emit("cm_notify_new_order",{number_guest:c.table1.number_guest,table_status:c.table1.table_status,status_name:c.table1.status_name,table_id:c.table1.table_id,order_id:c.table1.order_id,room:"waiter"}),AppTable.socket.emit("cm_notify_new_order",{number_guest:c.table2.number_guest,table_status:c.table2.table_status,status_name:c.table2.status_name,table_id:c.table2.table_id,order_id:c.table2.order_id,room:"waiter"}),AppTable.isChangeTable=!1,AppTable.isSelectTableFirst=!1,a("#floor_id").val(1),setTimeout(function(){window.location.reload()},1e3)):(AppTable.loadingOverlay.hide(),alert("Pindahkan meja gagal dilakukan"))}}).fail(function(){alert("failed"),window.location.reload()})):(AppTable.loadingOverlay.hide(),console.log("table not empty"),AppTable.isSelectTableFirst=!1))}),a(".btn-trans").click(function(){a(".popup-block").hide()}),a(".btn-prev").click(function(b){console.log("previous"),a(".alert-danger").hide();var c=a("#floor_id").val(),d=a("#store_id").val();""!=c&&(1!=c?(c=parseInt(c)-1,a.ajax({type:"POST",url:AppTable.baseUrl+"table/previous_floor",data:{floor_id:c,store_id:d}}).done(function(b){if(""!=b){var c=JSON.parse(b);a("#floor_id").val(c.floor_id),a("#floor_name").text(c.floor_name);var d=c.data_table,e="";for(i=0;i<d.length;i++)e+='<div class="table-list table2 status-'+d[i].status_name+'" style="top:'+d[i].pos_y+"px;left:"+d[i].pos_x+'%;"><p class="table-name">'+d[i].status_name+'</p><p class="table-status">'+d[i].table_status+'</p><input type="hidden" id="table_id_selected" value="'+d[i].table_id+'"><input type="hidden" id="number_guest_selected" value="'+d[i].customer_count+'"><input type="hidden" id="table_status_selected" value="'+d[i].table_status+'"><input type="hidden" id="order_id_selected" value="'+d[i].order_id+'"></div>';a(".table-container").html(e)}}).fail(function(){alert("failed")})):a("#floor_id").val(1)),b.preventDefault()}),a(".btn-next").click(function(b){console.log("next"),a(".alert-danger").hide();var c=a("#floor_id").val(),d=a("#store_id").val();""!=c&&(c=parseInt(c)+1,a.ajax({type:"POST",url:AppTable.baseUrl+"table/next_floor",data:{floor_id:c,store_id:d}}).done(function(b){if(console.log(b),""!=b){var c=JSON.parse(b);a("#floor_id").val(c.floor_id),a("#floor_name").text(c.floor_name);var d=c.data_table;console.log(d);var e="";for(i=0;i<d.length;i++)e+='<div class="table-list table2 status-'+d[i].status_name+'" style="top:'+d[i].pos_y+"px;left:"+d[i].pos_x+'%;"><p class="table-name">'+d[i].status_name+'</p><p class="table-status">'+d[i].table_status+'</p><input type="hidden" id="table_id_selected" value="'+d[i].table_id+'"><input type="hidden" id="number_guest_selected" value="'+d[i].customer_count+'"><input type="hidden" id="table_status_selected" value="'+d[i].table_status+'"><input type="hidden" id="order_id_selected" value="'+d[i].order_id+'"></div>';a(".table-container").html(e)}}).fail(function(){alert("failed")})),b.preventDefault()}),a(".btn-change-table").click(function(b){AppTable.isChangeTable?(AppTable.isChangeTable=!1,a(".table-container").find(".status-completed").css("background-color",""),a(".table-container").find(".status-order").css("background-color",""),a(".table-container").find(".status-waiting").css("background-color",""),a(".table-container").find(".status-empty").css("background-color",""),a(".btn-change-table").text("Pindahkan Meja")):(AppTable.isChangeTable=!0,AppTable.isSelectTableFirst=!0,console.log("change table"),a(".table-container").find(".status-empty").css("background-color","red"),a(".btn-change-table").text("Batalkan")),b.preventDefault()}),a(".new_order").on("click",function(b){var c=a(this).attr("href"),d=a("#new_order_url").val(),e=a(this).data("guest"),f=a("#new_table_id").val(),g=a.ajax({type:"POST",url:c,data:{number_guest:e,table_status:"1",table_id:f,order_id:"0"}});g.done(function(a){var b=JSON.parse(a);AppTable.socket.emit("cm_notify_new_order",{number_guest:b.number_guest,table_status:b.table_status,status_name:b.status_name,table_id:b.table_id,order_id:b.order_id,room:"waiter"}),window.location=d}),g.fail(function(a,b){}),g.always(function(){}),b.preventDefault()})}}});