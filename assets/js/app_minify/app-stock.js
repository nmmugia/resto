define(["jquery","bootstrap"],function(a,b){return{nodeUrl:a("#node_url").val(),baseUrl:a("#base_url").val(),socket:!1,loadingOverlay:a("#cover"),init:function(){console.log("App Stock inited.."),AppStock.loadingOverlay.show(),AppStock.initFunc(AppStock);try{AppStock.initSocketIO()}catch(b){AppStock.loadingOverlay.hide(),a("#server-error-message").dialog({dialogClass:"no-close",modal:!0,closeOnEscape:!1,buttons:{Reload:function(){window.location.reload(!0)}}})}},initSocketIO:function(){AppStock.socket=io(AppStock.nodeUrl,{reconnectionAttempts:2}),AppStock.socket.on("reconnect_failed",function(){AppStock.loadingOverlay.hide(),a("#server-error-message").dialog({dialogClass:"no-close",modal:!0,closeOnEscape:!1,buttons:{Reload:function(){window.location.reload(!0)}}})}),AppStock.socket.on("connected",function(a){console.log("Socket.IO connected"),AppStock.initUIEvent(),AppStock.loadingOverlay.hide(),AppStock.socket.on("sm_notify_menu_available_status",function(a){console.log(a)})})},initUIEvent:function(){a(document).on("click",".btn-cancel",function(){a(".popup-block").hide()}),a(document).on("click",".menu-order",function(){var b=a(this).children(),c=a("#stock_menu_by_inventory").val();""!=b&&a.ajax({type:"POST",url:AppStock.baseUrl+"stock/get_menu_by_catergory",data:{category_id:a(b[2]).val()}}).done(function(d){if(""!=d){var e=JSON.parse(d),f="",g="";if(a(".category-name").text(a(b[1]).text()),0!=e.length)for(i=0;i<e.length;i++){var h=AppStock.baseUrl+"/assets/img/default-menus.jpg";""!=e[i].icon_url&&(h=AppStock.baseUrl+e[i].icon_url),g=0==e[i].available?"Set Available":1!=c?"Set Available":"Set Habis",f+='<div class="menu-stock"><img src="'+h+'" alt="menu" /><p>'+e[i].menu_name+'</p><button class="btn btn-trans stock-btn" id="'+e[i].available+'">'+g+'</button><input id="menu_id" type="hidden" value="'+e[i].id+'"/></div>'}else f+='<h5 style="color:#898989">Tidak ada menu</h5>';a(".container-menus").html(f)}else AppStock.alert("Gagal menampilkan menu. Silahkan coba lagi. Jika masalah masih terjadi mohon hubungi administrator.")}).fail(function(){AppStock.alert("Gagal menampilkan menu. Silahkan coba lagi. Jika masalah masih terjadi mohon hubungi administrator.")})}),a(document).on("click",".stock-btn",function(b){console.log("button set available pressed...");var c=this.id,d=a(this).closest("div"),e=d.children(),f=a("#stock_menu_by_inventory").val(),g=a(this).data("menu-quantity"),h=a(e[3]).val();1!=f?(b.preventDefault(),AppStock.setAvailableMenu(h)):(a.ajax({type:"POST",url:AppStock.baseUrl+"stock/update_available_status",data:{menu_id:h,available:c,quantity:g}}).done(function(b){""!=b&&(1==c?(a(e[2]).text("Set Available"),a(e[2]).attr("id",0)):(a(e[2]).text("Set Habis"),a(e[2]).attr("id",1)))}).fail(function(){AppStock.alert("Gagal mengupdate status ketersediaan. Silahkan coba lagi. Jika masalah masih terjadi mohon hubungi administrator.")}),b.preventDefault())})},setAvailableMenu:function(b){var c=a.ajax({type:"POST",url:AppStock.baseUrl+"stock/get_menu",data:{menu_id:b}});c.done(function(b){if(""!=b){var c=JSON.parse(b);a(".popup-available-menu").show(),a(".title-popup").text(c.menu_name),a("#menu_quantity_val").val(c.menu_quantity),a("#menu_id_val").val(c.id)}}),c.fail(function(a,b){AppStock.alert("Gagal mengambil data menu. Silahkan coba lagi. Jika masalah masih terjadi mohon hubungi administrator.")}),c.always(function(){}),a("#btn-ok").on("click",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a.ajax({type:"POST",url:AppStock.baseUrl+"stock/update_available_status",data:{menu_id:a("#menu_id_val").val(),quantity:a("#menu_quantity_val").val()}});c.done(function(b){""!=b&&a(".popup-available-menu").hide()}),c.fail(function(a,b){AppStock.alert("Gagal mengupdate status ketersediaan. Silahkan coba lagi. Jika masalah masih terjadi mohon hubungi administrator.")}),c.always(function(){})})}}});