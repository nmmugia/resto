define(["jquery","jquery-ui","bootstrap","keyboard","easyautocomplete"],function(a,b){return{nodeUrl:a("#node_url").val(),baseUrl:a("#base_url").val(),socket:!1,isChangeTable:!1,isSelectTableFirst:!1,isSelectTableSecond:!1,isMergeTable:!1,firstTableId:"",tableBeforeMerge:[],firstOrderId:"",secondTableId:"",statusTable:"",loadingOverlay:a("#cover"),userId:a("#user_id").val(),groupId:a("#group_id").val(),groupName:a("#group_name").val(),userName:a("#user_name").val(),tableParent:a("#table-parent"),alreadyProcess:a("#already_process").val(),alreadyCompleted:a("#already_completed").val(),isEdit:!1,inputNumber:a(".input-number"),orderIsView:a("#order_is_view").val(),isDineIn:a("#is_dine_in").val(),useKitchen:a("#use_kitchen").val(),diningType:a("#dining_type").val(),useCleaningProcess:a("#cleaning_process").val(),useRoleChecker:a("#use_role_checker").val(),autoChecker:a("#auto_checker").val(),timeoutVal:1e4,arrMergeTable:[],totalStockAvailable:0,touchTimer:0,init:function(){console.log("App Table inited.."),console.log(AppTable.nodeUrl),AppTable.loadingOverlay.show(),AppTable.checkAllReady(),AppTable.initFunc(AppTable),AppTable.initTakeaway(),AppTable.initDelivery();try{AppTable.initSocketIO()}catch(b){AppTable.alert(a("#server-error-message p").text())}AppTable.initKeyboard();/mobile|android/i.test(navigator.userAgent);AppTable.initListFilter(),AppTable.checkPrevNextFloor()},initListFilter:function(){var a={valueNames:["name"]};new List("menus",a)},initSocketIO:function(){AppTable.socket=io(AppTable.nodeUrl,{reconnectionAttempts:2}),AppTable.socket.on("reconnect_failed",function(){AppTable.alert(a("#server-error-message p").text()),window.location.reload(!0)}),AppTable.socket.on("connected",function(b){console.log("Socket.IO connected"),AppTable.socket.emit("cm_auth",{nip:AppTable.userId,name:AppTable.userName,role:AppTable.groupId,role_name:AppTable.groupName}),AppTable.socket.on("sm_auth",function(a){AppTable.loadingOverlay.hide(),AppTable.initUIEvent()}),AppTable.socket.on("sm_notify_open_close_cashier",function(a){window.location=AppTable.baseUrl}),AppTable.socket.on("sm_notify_new_order",function(b){var c=a("#tab_layout_"+b.table_id);if(c.removeClass().addClass(b.status_class),c.data("table-status",b.table_status),c.data("order-id",b.order_id),c.data("customer-count",b.number_guest),c.attr("data-reservation-id",b.reservation_id),c=a("#list_layout_"+b.table_id),c.removeClass(),c.addClass("table-list-text label-rect-"+b.status_name),c.data("table-status",b.table_status),c.data("order-id",b.order_id),c.data("customer-count",b.number_guest),c.attr("data-reservation-id",b.reservation_id),AppTable.updateStockMenu(b.arr_menu_outlet),b.warning_badge===!0?AppTable.prependWarning(b.table_id):AppTable.removeWarning(b.table_id),null!=b.arr_merge_table&&b.arr_merge_table.length>0){AppTable.prependBadge(b.table_id,b.table_name);for(var d=0;d<b.arr_merge_table.length;d++){var e=a("#tab_layout_"+b.arr_merge_table[d].id);e.removeClass().addClass(b.arr_merge_table[d].status_class),e.data("table-status",b.table_status),e.data("order-id",b.order_id),e.data("customer-count",b.number_guest),e.data("parent-id",b.table_id),e=a("#list_layout_"+b.arr_merge_table[d].id),e.removeClass(),e.addClass("table-list-text label-rect-"+b.status_name),e.data("table-status",b.table_status),e.data("order-id",b.order_id),e.data("customer-count",b.number_guest),e.data("parent-id",b.table_id),AppTable.prependBadge(b.arr_merge_table[d].id,b.table_name)}}}),AppTable.socket.on("sm_empty_table",function(b){console.log(b);var c=a("#order_id").val();"1"==AppTable.isDineIn&&c==b.order_id&&(window.location=b.url_redir);var d=a("#tab_layout_"+b.table_id);if(""!=b.status_class&&d.removeClass().addClass(b.status_class),d.data("table-status",b.table_status),d.data("order-id",b.order_id),d.data("customer-count",b.number_guest),d=a("#list_layout_"+b.table_id),d.removeClass(),d.addClass("table-list-text label-rect-"+b.status_name),d.data("table-status",b.table_status),d.data("order-id",b.order_id),d.data("customer-count",b.number_guest),1==b.table_status&&(AppTable.removeWarning(b.table_id),a("#tab_layout_"+b.table_id+" .badge-table").remove(),a("#list_layout_"+b.table_id+" .badge-table-small").remove()),merge_table=b.arr_merge_table,null!=merge_table)for(var e=0;e<merge_table.length;e++){var f=a("#tab_layout_"+merge_table[e].id);f.removeClass().addClass(merge_table[e].status_class),f.data("table-status",b.table_status),f.data("order-id",b.order_id),f.data("customer-count",b.number_guest),f.data("parent-id","0"),f=a("#list_layout_"+merge_table[e].id),f.removeClass(),f.addClass("table-list-text label-rect-"+b.status_name),f.data("table-status",b.table_status),f.data("order-id",b.order_id),f.data("customer-count",b.number_guest),f.data("parent-id","0"),1==b.table_status&&(AppTable.removeWarning(merge_table[e].id),a("#tab_layout_"+merge_table[e].id+" .badge-table").remove(),a("#list_layout_"+merge_table[e].id+" .badge-table-small").remove())}}),AppTable.socket.on("sm_cancel_merge",function(a){for(ids=a.ids,i=0;i<ids.length;i++)AppTable.removeBadge(ids[i]);console.log("Cancel"),window.location.reload(!0)}),AppTable.socket.on("sm_notify_menu_available_status",function(a){"1"==AppTable.isDineIn&&(1==a.available?AppTable.alert("Pesan dari kitchen : Menu "+a.menu_name+" habis"):AppTable.alert("Pesan dari kitchen : Menu "+a.menu_name+" tersedia")),window.location.reload(!0)}),AppTable.socket.on("sm_notify_cooking_status",function(b){var c=a("#status_menu_"+b.order_menu_id),d=b.status_name;c.html(d),c.parents("tr:first").find("td:eq(9)").html(b.cooking_status),a(".list_order[data-order_id='"+b.order_id+"']").find("td[data-order_menu_id='"+b.order_menu_id+"']").attr("data-cooking-status",b.cooking_status).attr("data-cooking_status",b.cooking_status),a(".list_order[data-order_id='"+b.order_id+"']").find("td[data-order_menu_id='"+b.order_menu_id+"']").html(b.status_name),null!=b.notification&&(AppTable.prependNotif(b.notification),AppTable.updateOpenNotifBar()),merge_table=b.arr_merge_table,6==b.cooking_status&&(a("#bgsound_notification").get(0).play(),AppTable.prependWarning(b.table_id)),AppTable.checkAllReady(b.order_id)}),AppTable.socket.on("sm_notify_merge_table",function(a){AppTable.prependBadge(a.parent_id,a.parent_name,a.status_class,a),AppTable.prependArrayBadge(a)}),AppTable.socket.on("sm_notify_call",function(a){null!=a.notification&&(AppTable.prependNotif(a.notification),AppTable.updateOpenNotifBar())}),AppTable.socket.on("sm_post_reservation",function(b){console.log(b);var c=a("#tab_layout_"+b.table_id);c.removeClass().addClass(b.status_class),c.data("table-status",b.table_status),c.data("order-id",b.order_id),c.attr("data-reservation-id",b.reservation_id),c=a("#list_layout_"+b.table_id),c.removeClass(),c.addClass("table-list-text label-rect-"+b.status_name),c.data("table-status",b.table_status),c.data("order-id",b.order_id),c.attr("data-reservation-id",b.reservation_id)}),AppTable.socket.on("sm_set_table_used",function(b){var c=b.table_id,d=b.is_used;if(0==d){AppTable.secondTableId=c,AppTable.loadingOverlay.show();var e=a.ajax({type:"POST",url:AppTable.baseUrl+"table/change_table",data:{first_table:AppTable.firstTableId,first_order:AppTable.firstOrderId,second_table:AppTable.secondTableId,reservation_id:a("#tab_layout_"+AppTable.firstTableId).attr("data-reservation-id")}});e.done(function(b){if(""!=b){var d=JSON.parse(b);d.status===!0?(AppTable.socket.emit("cm_notify_new_order_to_all",{number_guest:d.table1.number_guest,table_status:d.table1.table_status,status_name:d.table1.status_name,status_class:d.table1.status_class,table_id:d.table1.table_id,order_id:d.table1.order_id,reservation_id:d.table1.reservation_id,room:"waiter"}),AppTable.socket.emit("cm_notify_new_order_to_all",{number_guest:d.table2.number_guest,table_status:d.table2.table_status,status_name:d.table2.status_name,status_class:d.table2.status_class,table_id:d.table2.table_id,order_id:d.table2.order_id,reservation_id:d.table2.reservation_id,room:"waiter"}),AppTable.isChangeTable=!1,AppTable.isSelectTableFirst=!1,AppTable.tableParent.find(".dine-in-order").css("opacity","1"),AppTable.tableParent.find(".dine-in-order").css("cursor","pointer"),AppTable.tableParent.find(".dine-in-order").show(),a(".btn-change-table").html('<span class="option-text">Pindahkan Meja</span> <span class="option-icon"><i class="fa fa-share-square"></i></span>'),a(".btn-merge-table").show(),AppTable.socket.emit("cm_remove_table_used",{table_id:c}),AppTable.socket.emit("cm_notify_change_table",{number_guest:d.data.number_guest,table_name:d.data.table_name,table_id:d.data.table_id,order_id:d.data.order_id}),AppTable.loadingOverlay.hide()):(AppTable.alert("Gagal memindahkan meja. Silahkan coba lagi. Jika masih gagal mohon hubungi administrator."),console.log(d.msg),window.location.reload(!0))}}),e.fail(function(b,d){AppTable.socket.emit("cm_remove_table_used",{table_id:c}),"timeout"==d&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),e.always(function(){})}})})},checkAllReady:function(b){if(3==AppTable.diningType){var c=0,d=0;a(".bill-table tbody tr").each(function(){0==parseInt(a(this).find("td:eq(9)").html())&&c++,3!=parseInt(a(this).find("td:eq(9)").html())&&d++}),c>0?(a("#btn-checkout-order").show(),a(".post_to_ready").hide()):(a("#btn-checkout-order").hide(),a(".post_to_ready").show()),0==d&&0==c?a("#btn-close-order").show():a("#btn-close-order").hide();var e=a(".bill-table > tbody  > tr").length;0==e&&a("#btn-close-order").hide()}else{var e=a(".bill-table > tbody  > tr").length,f=0;a(".bill-table tbody tr").each(function(){3!=parseInt(a(this).find("td:eq(9)").html())&&f++}),0==f&&e>0?a("#btn-checkout-order").show():a("#btn-checkout-order").hide(),void 0!=b&&(a(".list_order[data-order_id='"+b+"'] td[data-cooking_status][data-cooking_status!=3]").length>0?a(".list_order[data-order_id='"+b+"'] #btn_payment_order_delivery").hide():a(".list_order[data-order_id='"+b+"'] #btn_payment_order_delivery").show())}},postToReady:function(b,c){var d={};if(a("#is_take_away").length>0){d.order_id=a("#order_id").val(),d.customer_name=b,d.customer_phone=c;var e=AppTable.baseUrl+"cashier/process_takeaway"}if(a("#is_delivery").length>0){var f=parseFloat(a("#delivery_cost").val());isNaN(f)&&(f=0),d.order_id=a("#order_id").val(),d.customer_name=b,d.customer_phone=c,d.customer_address=a("#customer_address").val(),d.delivery_cost_id=a("#delivery_cost_id").val(),d.delivery_cost=f;var e=AppTable.baseUrl+"cashier/process_delivery"}if(a("#is_dine_in").length>0){d.order_id=a("#order_id").val();var e=AppTable.baseUrl+"table/process_order"}var g=a.ajax({type:"POST",url:e,data:d});g.done(function(b){var c=JSON.parse(b);AppTable.socket.emit("cm_notify_new_order",{number_guest:c.number_guest,table_status:c.table_status,status_name:c.status_name,status_class:c.status_class,table_id:c.table_id,table_name:c.table_name,order_id:order_id,arr_merge_table:c.arr_merge_table,floor_id:c.floor_id,room:"kasir",notification:c.notification,outlets:c.outlets}),0==AppTable.useKitchen&&1==AppTable.useRoleChecker&&AppTable.socket.emit("cm_notify_checker",{}),setTimeout(function(){window.location.href=a(".post_to_ready").attr("href")},100)}),g.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),g.always(function(){})},initUIEvent:function(){a("#hidden_menu").on("mousedown touchstart",function(b){b.preventDefault(),document.getElementById("hidden_menu_dv").className="col-md-4",document.getElementById("hidden_order_dv").className="panel-wrapper hidden-xs hidden-sm",document.getElementById("hidden_customer_dv").className="col-md-4 hidden-xs hidden-sm",a(".mobile-sub-menu").removeClass("active"),a(this).addClass("active")}),a("#hidden_order").on("mousedown touchstart",function(b){b.preventDefault(),document.getElementById("hidden_menu_dv").className="col-md-4 hidden-xs hidden-sm",document.getElementById("hidden_order_dv").className="panel-wrapper ",document.getElementById("hidden_customer_dv").className="col-md-4 hidden-xs hidden-sm",a(".mobile-sub-menu").removeClass("active"),a(this).addClass("active")}),a("#hidden_customer").on("mousedown touchstart",function(b){b.preventDefault(),document.getElementById("hidden_customer_dv").className="col-md-4",document.getElementById("hidden_menu_dv").className="col-md-4 hidden-xs hidden-sm",document.getElementById("hidden_order_dv").className="panel-wrapper hidden-xs hidden-sm",a(".mobile-sub-menu").removeClass("active"),a(this).addClass("active")}),a(".count-order").unbind("keyup").bind("keyup",function(){value=parseInt(a(this).val()),isNaN(value)&&(value=0),value<=0?a(this).val(1):a(this).val(value)}),a(".delete_order_all").on("click",function(b){function c(){if(user_confirmation=d.attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation)return AppNav.showConfirmationPIN(user_confirmation,".delete_order_all","click",1),!1;order_id=d.attr("order_id");var b=a.ajax({url:AppTable.baseUrl+"table/delete_order",type:"POST",dataType:"JSON",data:{order_id:order_id}});b.done(function(a){1==a.status?(console.log(a),window.location.href=AppTable.baseUrl+"table"):AppTable.alert(a.message)}),b.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),b.always(function(){})}var d=a(this);a(this).attr("skip_confirm")?c():(AppTable.confirm("Anda yakin ingin hapus order?",c),b.preventDefault())}),a(".post_to_ready").on("click",function(b){user_confirmation=a(this).attr("feature_confirmation");var c=a("#customer_name").val(),d=a("#customer_phone").val(),e=a(".bill-table > tbody  > tr").length;if(a("#is_take_away").length>0||a("#is_delivery").length>0){if(""==c)return AppTable.alert("Silahkan isi nama pelanggan terlebih dahulu"),!1;if(0==e)return AppTable.alert("No Orders!"),!1}return void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation?(AppNav.showConfirmationPIN(user_confirmation,".post_to_ready","click",1),!1):(AppTable.postToReady(c,d),!1)}),a("#print_list_menu").on("click",function(b){AppTable.loadingOverlay.show();var c=a("#order_id").val();url=AppTable.baseUrl+"cashier/print_list_menu";a.ajax({type:"POST",url:url,data:{order_id:c}});AppTable.loadingOverlay.hide()}),a(document).ready(function(){AppTable.resizePanel(),a("#floor_id").val(a("#floor_default_id").val()),"1"==AppTable.alreadyProcess?a("#btn-reset-order").hide():a("#btn-reset-order").show(),"2"==AppTable.alreadyCompleted?(a("#btn-reset-order").show(),a("#btn-process-order").show()):(a("#btn-reset-order").show(),a("#btn-process-order").show()),"5"==AppTable.alreadyCompleted&&(a("#btn-reset-order").show(),a("#btn-process-order").hide(),a("#btn-checkout-order").hide())}),a(document).ajaxStop(function(){AppTable.resizePanel()}),a(document).on("click",".btn-number",function(b){b.preventDefault();var c=a(this).attr("data-field"),d=a(this).attr("data-type"),e=a(this).siblings("input[name='"+c+"']"),f=parseInt(e.val());isNaN(f)?e.val(1):"minus"==d?(f>e.attr("min")&&e.val(f-1).change(),parseInt(e.val())==e.attr("min")):"plus"==d&&(f<e.attr("max")&&e.val(f+1).change(),parseInt(e.val())==e.attr("max"))}),a(document).on("click",".btn-number-void",function(b){b.preventDefault();var c=a(this).attr("data-type"),d=a("#input_void_count"),e=parseInt(d.val());isNaN(e)?d.val(1):"minus"==c?(e>d.attr("min")&&d.val(e-1).change(),parseInt(d.val())==d.attr("min")):"plus"==c&&(e<d.attr("max")&&d.val(e+1).change(),parseInt(d.val())==d.attr("max"))}),AppTable.inputNumber.focusin(function(){a(this).data("oldValue",a(this).val())}),AppTable.inputNumber.on("keydown",function(a){}),AppTable.inputNumber.on("change",function(b){var c=parseInt(a(this).attr("min")),d=parseInt(a(this).attr("max")),e=parseInt(a(this).val()),f=a(this).attr("name");e>=c?a(".btn-number[data-type='minus'][data-field='"+f+"']").removeAttr("disabled"):""!=a(this).data("oldValue")||a(this).val(c),d>=e?a(".btn-number[data-type='plus'][data-field='"+f+"']").removeAttr("disabled"):""!=a(this).data("oldValue")?a(this).val(a(this).data("oldValue")):a(this).val(d)}),a(document).on("click",".dine-in-order, .table-list-text ",function(b){if(1!=AppNav.openCloseStatus)return!1;var c=a(this).data("table-id"),d=a(this).data("table-status"),e=a(this).data("order-id"),f=(a(this).data("customer-count"),a("#new_order_url").val()),g=(a("#tab_layout_"+c),a(this).has(".badge-table").length),h=a(this).data("parent-id");if("0"!=h){var i=a("#tab_layout_"+h);c=h,d=i.data("table-status"),e=i.data("order-id")}var j=(a("#tab_layout_"+AppTable.firstTableId),a(this).data("reservation-id"));if(void 0==j&&(j=0),AppTable.isMergeTable)0==j&&7!=d&&AppTable.mergeTableProcess(c);else if(AppTable.isChangeTable)if(AppTable.isSelectTableFirst)1!=d&&7!=d&&6!=d&&0==g?(AppTable.firstTableId=c,AppTable.firstOrderId=e,AppTable.isSelectTableFirst=!1,AppTable.disableEmptyTable(!1)):AppTable.isSelectTableFirst=!0;else{var k="0"!=a(this).data("parent-id"),l=a(".dine-in-order[data-parent-id="+a(this).data("table-id")+"]").length>0,m=k||l;1!=d||m?AppTable.isSelectTableFirst=!1:AppTable.socket.emit("cm_set_table_used",{table_id:c})}else if(AppTable.socket.emit("cm_remove_table_used",{table_id:c}),"1"==d)a("#new_table_id").val(c),a("#popup-customer-count").find(".reservation-active").removeClass("reservation-active"),a("#popup-customer-count").removeAttr("reservation_id"),a("#popup-customer-count").show();else if("7"==d)1==AppTable.useCleaningProcess&&AppTable.confirm("Apakah meja ini sudah siap dipakai oleh tamu ?",AppTable.updateCleaningProcess,c);else if("6"==d){if(user_confirmation=a(this).attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation)return void AppNav.showConfirmationPIN(user_confirmation,'.dine-in-order[data-reservation-id="'+j+'"]',"click",1);var n=AppTable.baseUrl+"table/get_reservation_table";a("#new_table_id").val(c);var o=a.ajax({type:"POST",url:n,data:{table_id:c}});o.done(function(b){if(""!=b){var c=JSON.parse(b);AppTable.socket.emit("cm_notify_new_order",{table_status:c.table_status,status_name:c.status_name,status_class:c.status_class,table_name:c.table_name,table_id:c.table_id,order_id:c.order_id,arr_merge_table:c.arr_merge_table,room:"waiter"}),a("#popup-block-reservation-detail").show(),a("#reservation_id").val(c.reservation_id),a("#reservation-detail").html(c.msg)}else window.location=AppTable.baseUrl;AppTable.reservationProcess()})}else window.location=f+"/"+e}),a(".btn-cancel-new-order, .btn-close-reserv").on("click",function(b){b.preventDefault(),a(".popup-block").hide(),a("#reservation_id").val(""),a(".input-pin").val("")}),a(".new_order").unbind("click").bind("click",function(b){var c=a(this).attr("href"),d=a("#new_order_url").val(),e=a(this).data("guest"),f=a("#new_table_id").val(),g=a("#reservation_id").val(),h=a("#reservation_status").val(),i=a("#tab_layout_"+f).data("table-status");if(1==i||6==i){var j=a.ajax({type:"POST",url:c,data:{number_guest:e,table_id:f,reservation_id:g,reservation_status:h}});j.done(function(a){if(""!=a){var b=JSON.parse(a);AppTable.socket.emit("cm_notify_new_order",{table_status:b.table_status,table_name:b.table_name,status_name:b.status_name,status_class:b.status_class,table_id:b.table_id,order_id:b.order_id,arr_merge_table:b.arr_merge_table,room:"waiter"}),setTimeout(function(){window.location=d},100)}else window.location=d}),j.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),j.always(function(){})}else AppTable.alert("Meja sudah diapakai oleh konsumen lain, silahkan pilih meja lain.");b.preventDefault()}),a(document).on("click",".btn-change-floor",function(b){if(1!=AppNav.openCloseStatus||a(this).hasClass("disabled-floor"))return!1;a(".alert-danger").hide();var c=a("#floor_id"),d=a("#floor_name"),e=c.val(),f=a(this).attr("href"),g=a(this).data("id");if(""!=e){var h=a.ajax({type:"POST",url:f,data:{floor_id:e,destination:g}});h.done(function(b){if(""!=b){var e=JSON.parse(b);e.status===!0?(c.val(e.floor_id),d.text(e.floor_name),AppTable.tableParent.html(e.data_table),a("#table-list").html(e.data_table_list),AppTable.isChangeTable&&(AppTable.isSelectTableFirst===!0?AppTable.disableEmptyTable(!0):AppTable.disableEmptyTable(!1)),AppTable.checkPrevNextFloor()):AppTable.alert(e.message)}else window.location.reload(!0)}),h.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),h.always(function(){})}b.preventDefault()}),a("#delivery_cost_id").on("change",function(a){AppTable.updateDeliveryOrderCalc()}),a(".btn-change-table").on("click",function(b){return 1!=AppNav.openCloseStatus?!1:(user_confirmation=a(this).attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation&&"batalkan"!=a(this).find(".option-text").text().toLowerCase()?void AppNav.showConfirmationPIN(user_confirmation,".btn-change-table","click",1):(AppTable.isChangeTable?(AppTable.isChangeTable=!1,AppTable.tableParent.find(".dine-in-order").css("opacity","1"),AppTable.tableParent.find(".dine-in-order").css("cursor","pointer"),AppTable.tableParent.find(".dine-in-order").show(),a(".btn-change-table").html('<span class="option-text">Pindahkan Meja</span> <span class="option-icon"><i class="fa fa-share-square"></i></span>'),a(".btn-merge-table").show()):0==a("#all_table_empty").val()?(AppTable.isChangeTable=!0,AppTable.isSelectTableFirst=!0,AppTable.disableEmptyTable(!0),AppTable.hideReservationTable(!0),a(".btn-change-table").html('<span class="option-text">Batalkan</span> <span class="option-icon"><i class="fa fa-undo"></i></span>'),a(".btn-merge-table").hide()):AppTable.alert("Tidak ada meja yang dapat dipindahkan"),void b.preventDefault()))}),a(".btn-ok-merge").on("click",function(b){if(AppTable.loadingOverlay.show(),AppTable.arrMergeTable.length>0){for(var c=[],d=0;d<AppTable.arrMergeTable.length;d++){var e=a("#tab_layout_"+AppTable.arrMergeTable[d]);c.push(a(e).data("order-id"))}var f=a.ajax({type:"POST",url:AppTable.baseUrl+"table/merge_table",data:{parent_id:AppTable.firstTableId,array_table:AppTable.arrMergeTable,floor_id:a("#floor_id").val(),parent_order_id:a("#tab_layout_"+AppTable.firstTableId).data("order-id"),array_order_id:c}});f.done(function(a){if(""!=a){var b=JSON.parse(a);b.status===!0?(AppTable.socket.emit("cm_notify_new_order",{table_status:b.table_status,table_name:b.table_name,status_name:b.status_name,status_class:b.status_class,table_id:b.table_id,order_id:b.order_id,arr_merge_table:b.arr_merge_table}),window.location.reload(!0)):AppTable.alert(b.message)}else window.location.reload(!0)}),f.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),f.always(function(){})}else AppTable.loadingOverlay.hide(),AppTable.alert("Minimal 2 tabel yang digabungkan")}),a(".btn-merge-table").on("click",function(b){if(1!=AppNav.openCloseStatus)return!1;if(user_confirmation=a(this).attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation&&"batalkan"!=a(this).find(".option-text").text().toLowerCase())return void AppNav.showConfirmationPIN(user_confirmation,".btn-merge-table","click",1);if(AppTable.isMergeTable){AppTable.isMergeTable=!1,AppTable.tableParent.find(".dine-in-order").css("opacity","1"),AppTable.tableParent.find(".dine-in-order").css("cursor","pointer"),a(".btn-merge-table").html('<span class="option-text">Gabungkan Meja</span> <span class="option-icon"><i class="fa fa-chain"></i></span>'),a(".btn-change-table").show(),a(".btn-ok-merge").hide(),a(".btn-change-floor").show(),a(".btn-option-list").show(),AppTable.hideReservationTable(!1),a(".dine-in-order").each(function(){for(var b=a(this).data("table-id"),c=0;c<AppTable.arrMergeTable.length;c++)AppTable.arrMergeTable[c]==b&&a("#tab_layout_"+b+" .badge-table").remove();a("#tab_layout_"+AppTable.firstTableId+" .badge-table").remove()}),AppTable.arrMergeTable=[];for(var c=0;c<AppTable.tableBeforeMerge.length;c++)object=AppTable.tableBeforeMerge[c],0==a("#tab_layout_"+object.table_id+" .badge-table").length?a("#tab_layout_"+object.table_id).prepend('<div class="badge-table">'+object.merge_number+"</div>"):a("#tab_layout_"+object.table_id+" .badge-table").html(object.merge_number)}else AppTable.tableBeforeMerge=[],a(".dine-in-order").each(function(){var b=a(this).data("table-id");a("#tab_layout_"+b+" .badge-table").length>0&&(temp={table_id:b,merge_number:a("#tab_layout_"+b+" .badge-table").text()},AppTable.tableBeforeMerge.push(temp))}),AppTable.isMergeTable=!0,AppTable.isSelectTableFirst=!0,AppTable.hideReservationTable(!0),a(".btn-merge-table").html('<span class="option-text">Batalkan</span> <span class="option-icon"><i class="fa fa-undo"></i></span>'),a(".btn-change-table").hide(),a(".btn-ok-merge").show(),a(".btn-change-floor").hide(),a(".btn-option-list").hide();b.preventDefault()}),a("#btn-notif").on("click",function(b){var c={direction:"right"};a(".notification-container").toggle("slide",c,500),a(".notification-container").addClass("open-notif"),AppTable.updateOpenNotifBar()}),a(".button-hide").on("click",function(b){var c={direction:"right"};a(".notification-container").toggle("slide",c,500);for(var d=a(".unseen-notif"),e=d.length-1;e>=0;e--){var f=d.eq(e).attr("data-id");AppTable.updateNotifCounter("-"),a("#notif-"+f+" ").removeClass("unseen-notif")}}),a(".notification-container").removeClass("open-notif"),AppTable.deleteNotif(),AppTable.dineInProcess()},updateCleaningProcess:function(b){AppTable.loadingOverlay.show(),a.ajax({type:"POST",url:AppTable.baseUrl+"table/updateCleaningProcess",dataType:"JSON",data:{table_id:b},success:function(b){var c=a("#tab_layout_"+b.table_id);c.attr("data-table-status",b.table_status),c.removeClass().addClass(b.status_class),c.data("table-status",b.table_status),c.data("order-id","0"),c.data("customer-count","0"),c.attr("data-reservation-id","0"),AppTable.socket.emit("cm_empty_table",{number_guest:0,table_status:b.table_status,status_class:b.status_class,table_id:b.table_id,order_id:0}),AppTable.loadingOverlay.hide()}})},closingOrder:function(){var b=a(".bill-table > tbody  > tr"),c=0;if(b.each(function(){var b=a(this).find(".status_menu_order").html();return b==all_cooking_status[3]?void(c+=1):void 0}),0==c&&3==AppTable.diningType)return AppTable.alert("Closing gagal, silahkan periksa kembali status pesanan anda."),!1;AppTable.loadingOverlay.show();var d=a("#order_id").val(),e=a("#btn-close-order").attr("href"),f=a.ajax({type:"POST",url:e,data:{order_id:d}});f.done(function(a){if(""!=a&&"0"!=a){var b=JSON.parse(a);b.status===!1?(AppTable.alert(b.message),AppTable.loadingOverlay.hide()):(AppTable.socket.emit("cm_empty_table",{number_guest:b.number_guest,table_status:b.table_status,table_name:b.table_name,status_name:b.status_name,status_class:b.status_class,table_id:b.table_id,url_redir:b.url_redir,order_id:b.order_id,arr_merge_table:b.arr_merge_table,room:"waiter"}),setTimeout(function(){window.location=b.url_redir},100))}else window.location.reload(!0)}),f.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),f.always(function(){})},initTakeaway:function(){a("#btn-process-takeaway").on("click",function(b){b.preventDefault();var c=a("#customer_name").val(),d=a("#customer_phone").val(),e=a(".bill-table > tbody  > tr").length;if(""==c)return AppTable.alert("Silahkan isi nama pelanggan terlebih dahulu"),!1;if(0==e)return AppTable.alert("No Orders!"),!1;AppTable.loadingOverlay.show();var f=a(this).attr("href"),g=a("#order_id").val(),h=a.ajax({type:"POST",url:f,data:{order_id:g,customer_name:c,customer_phone:d}});h.done(function(a){var b=JSON.parse(a);AppTable.socket.emit("cm_notify_new_order",{number_guest:b.number_guest,order_id:g,room:"kasir",outlets:b.outlets}),0==AppTable.useKitchen&&1==AppTable.useRoleChecker&&AppTable.socket.emit("cm_notify_checker",{}),setTimeout(function(){window.location=b.url_redir},100)}),h.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),h.always(function(){})}),a("#btn-reset-takeaway").on("click",function(b){function c(){AppTable.loadingOverlay.show();var b=d.attr("href"),c=a("#order_id").val(),e=a.ajax({type:"POST",url:b,data:{order_id:c}});e.done(function(a){var b=JSON.parse(a);b.status===!1?(AppTable.alert("Pesanan tidak dapat dihapus karena pesanan sudah diproses. Silahkan checkout pesanan terlebih dahulu!"),AppTable.loadingOverlay.hide()):window.location=b.url_redir}),e.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),e.always(function(){})}var d=a(this);AppTable.confirm("Apakah anda yakin akan reset pesanan ini?",c),b.preventDefault()})},initDelivery:function(){is_delivery=a("#is_delivery").val(),void 0==is_delivery&&(is_delivery=0),is_takeaway=a("#is_takeaway").val(),void 0==is_takeaway&&(is_takeaway=0),url_autocomplete=AppTable.baseUrl+"cashier/get_customer_auto_complete?is_delivery="+is_delivery+"&is_takeaway="+is_takeaway,options={url:url_autocomplete,getValue:"customer_name",template:{type:"description",fields:{description:"customer_address"}},list:{onSelectItemEvent:function(){var b=a("#customer_name").getSelectedItemData();a("#customer_address").val(b.customer_address),a("#customer_phone").val(b.customer_phone)},match:{enabled:!0}},theme:"plate-dark"},a("#delivery_cost").on("keyup",function(){var b=parseFloat(a(this).val());isNaN(b)&&(b=0),0>b&&(b=0),a(this).val(b)}),a("#delivery_cost_id").on("change",function(){delivery_cost=a(this).find("option:selected").data("delivery_cost"),is_percentage=a(this).find("option:selected").data("is_percentage"),a("#delivery_cost").val(AppTable.formatDeliveryCost(delivery_cost,is_percentage))}),a("#btn-process-delivery").on("click",function(b){b.preventDefault();var c=a("#customer_name").val(),d=a("#customer_phone").val(),e=a("#customer_address").val(),f=a("#delivery_cost_id").val(),g=parseFloat(a("#delivery_cost").val());isNaN(g)&&(g=0);var h=a(".bill-table > tbody  > tr").length;if(""==c||""==d||""==e||""==f)return AppTable.alert("Silahkan isi data pelanggan terlebih dahulu"),!1;if(0==h)return AppTable.alert("No Orders!"),!1;AppTable.loadingOverlay.show();var i=a(this).attr("href"),j=a("#order_id").val(),k=a.ajax({type:"POST",url:i,data:{order_id:j,customer_name:c,customer_phone:d,customer_address:e,delivery_cost_id:f,delivery_cost:g}});k.done(function(a){var b=JSON.parse(a);AppTable.socket.emit("cm_notify_new_order",{number_guest:b.number_guest,table_status:b.table_status,status_name:b.status_name,status_class:b.status_class,table_id:b.table_id,table_name:b.table_name,order_id:b.order_id,arr_merge_table:b.arr_merge_table,arr_menu_outlet:b.arr_menu_outlet,room:"waiter",outlets:b.outlets}),0==AppTable.useKitchen&&1==AppTable.useRoleChecker&&AppTable.socket.emit("cm_notify_checker",{}),setTimeout(function(){window.location=b.url_redir},100)}),k.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),k.always(function(){})}),a("#btn-reset-delivery").on("click",function(b){function c(){AppTable.loadingOverlay.show();var b=d.attr("href"),c=a("#order_id").val(),e=a.ajax({type:"POST",url:b,data:{order_id:c}});e.done(function(a){var b=JSON.parse(a);b.status===!1?(AppTable.alert("Pesanan tidak dapat dihapus karena pesanan sudah diproses. Silahkan checkout pesanan terlebih dahulu!"),AppTable.loadingOverlay.hide()):window.location=b.url_redir}),e.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),e.always(function(){})}var d=a(this);AppTable.confirm("Apakah anda yakin akan reset pesanan ini?",c),b.preventDefault()})},updateOpenNotifBar:function(){if(a(".notification-container").hasClass("open-notif"))for(var b=a(".unseen-notif"),c=0;c<b.length;c++){var d=b.eq(c).attr("data-id"),e=a.ajax({
type:"POST",url:AppTable.baseUrl+"notification/update_notif",data:{notif_id:d}});e.done(function(){})}},updateNotifCounter:function(b){var c=parseInt(a(".counter-notification").html());"+"==b?(isNaN(c)&&(a("#btn-notif").append('<div class="counter-notification">0</div>'),c=0),a(".counter-notification").html(c+1).change()):(0>c-1&&(c=1),a(".counter-notification").html(c-1).change(),0==a(".counter-notification").html()&&a(".counter-notification").hide())},prependNotif:function(b){window.navigator&&window.navigator.vibrate&&navigator.vibrate([1e3,500,1e3,500,2e3]);for(var c=b.length-1;c>=0;c--)if(b[c].to_user==AppTable.userId){a(".empty-notif").remove();var d='<div class="list-notification unseen-notif" id="notif-'+b[c].notif_id+'" data-id="'+b[c].notif_id+'" ><p class="content-notif" >'+b[c].msg+'</p><a class="button-ok-notif" href="#" data-id="'+b[c].notif_id+'"></a></div>';a("#notification-container-list").prepend(d),AppTable.updateNotifCounter("+"),a(".counter-notification").show()}AppTable.deleteNotif()},deleteNotif:function(){a(".button-ok-notif").on("click",function(b){AppTable.loadingOverlay.show();var c=a(this).attr("data-id"),d=a.ajax({type:"POST",url:AppTable.baseUrl+"notification/delete_notif",data:{notif_id:c}});d.done(function(){a("#notif-"+c).remove(),AppTable.updateNotifCounter("-"),AppTable.loadingOverlay.hide()})})},hideReservationTable:function(b){b?a(".dine-in-order").each(function(b,c){var d=a("#"+c.id),e=a(this).data("reservation-id"),f=a(this).data("table-status");(0!=e||7==f)&&(d.css("opacity","0.3"),d.css("cursor","default"))}):(AppTable.tableParent.find(".dine-in-order").css("opacity","1"),AppTable.tableParent.find(".dine-in-order").css("cursor","pointer"))},disableEmptyTable:function(a){a===!0?(AppTable.tableParent.find(".dine-in-order").css("opacity","1"),AppTable.tableParent.find(".dine-in-order").css("cursor","pointer"),AppTable.tableParent.find(".label-triangle-empty").css("opacity","0.3"),AppTable.tableParent.find(".label-triangle-empty").css("cursor","default"),AppTable.tableParent.find(".label-rect-empty").css("opacity","0.3"),AppTable.tableParent.find(".label-rect-empty").css("cursor","default"),AppTable.tableParent.find(".label-circle-empty").css("opacity","0.3"),AppTable.tableParent.find(".label-circle-empty").css("cursor","default"),AppTable.tableParent.find(".dine-in-order").children(".badge-table").parent().css("opacity","0.3"),AppTable.tableParent.find(".dine-in-order").children(".badge-table").parent().css("cursor","default")):(AppTable.tableParent.find(".dine-in-order").css("opacity","0.3"),AppTable.tableParent.find(".dine-in-order").css("cursor","default"),AppTable.tableParent.find(".label-triangle-empty").css("opacity","1"),AppTable.tableParent.find(".label-triangle-empty").css("cursor","pointer"),AppTable.tableParent.find(".label-rect-empty").css("opacity","1"),AppTable.tableParent.find(".label-rect-empty").css("cursor","pointer"),AppTable.tableParent.find(".label-circle-empty").css("opacity","1"),AppTable.tableParent.find(".label-circle-empty").css("cursor","pointer"),AppTable.tableParent.find(".dine-in-order").children(".badge-table").parent().css("opacity","0.3"),AppTable.tableParent.find(".dine-in-order").children(".badge-table").parent().css("cursor","default")),AppTable.tableParent.find(".dine-in-order[data-table-status='7']").css({opacity:"0.3",cursor:"default"})},transferProcess:function(b){a(".btn-transfer-order").show(),a(".btn-transfer-order").unbind("click").bind("click",function(c){a("#input_void_note").val(""),c.preventDefault();var d=(a(b[9]).text(),a(b[8]).text(),a("#order_id").val(),a(b[11]).text());a("#input_void_count").val("1"),a("#input_void_count").attr("max",d),a(".input-quantity-transfer").attr("max",d),a("#popup-transfer").show(),a(".input-quantity-transfer").unbind("keyup blur").bind("keyup blur",function(b){min=a(this).attr("min"),max=a(this).attr("max"),value=parseInt(a(this).val()),isNaN(value)&&(value=0),void 0!=min&&value<min&&a(this).val(min),void 0!=max&&value>max&&a(this).val(max)}),a(".btn-save-transfer").unbind("click").bind("click",function(b){b.preventDefault(),AppTable.loadingOverlay.show();var c=a(".input-quantity-transfer").val(),d=a.ajax({type:"POST",url:AppTable.baseUrl+"table/transfer_order_menu",data:{quantity:c,from_table_id:a("#table_id").val(),to_table_id:a(".to_table_id").val(),order_menu_id:a("#menu_order_id_selected").val(),note:a(".input-note").val()}});d.done(function(b){var c=JSON.parse(b);1==c.status?(a(".bill-table tbody").html(c.order_list),a(".total-payment tbody").html(c.order_bill),a(".popup-block").hide(),a(".input-note").val(""),AppTable.socket.emit("cm_notify_new_order",{table_status:c.table_status,status_name:c.status_name,status_class:c.status_class,table_name:c.table_name,table_id:c.table_id,order_id:c.order_id,arr_merge_table:c.arr_merge_table,room:"waiter"})):AppTable.alert(c.msg),AppTable.checkAllReady(),AppTable.loadingOverlay.hide()})}),a(".btn-cancel-transfer").on("click",function(b){a("#popup-transfer").hide(),a(".input-note").val("")})})},voidProcess:function(b){a(".btn-void-order").show(),a("#input_void_count").unbind("keyup blur").bind("keyup blur",function(b){min=a(this).attr("min"),max=a(this).attr("max"),value=parseInt(a(this).val()),isNaN(value)&&(value=0),void 0!=min&&value<min&&a(this).val(min),void 0!=max&&value>max&&a(this).val(max)}),a(".btn-void-order").unbind("click").bind("click",function(c){if(user_confirmation=a(this).attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation)return void AppNav.showConfirmationPIN(user_confirmation,".btn-void-order","click",1);a("#input_void_note").val(""),c.preventDefault();var d=a(b[9]).text(),e=a(b[8]).text(),f=a("#order_id").val(),g=a(b[11]).text();0==d||6==d?a("#is_decrease_stock").prop("checked",!1):a("#is_decrease_stock").prop("checked",!1),a("#input_void_count").val("1"),a("#input_void_count").attr("max",g),a("#popup-void").show(),a(".btn-save-void").unbind("click").bind("click",function(b){a("#input_pin").val(""),AppTable.startRequestVoid(f,e)}),a(".btn-cancel-void").on("click",function(b){a("#popup-void").hide(),a("#input_pin").val("")})})},startTouchTimer:function(a){AppTable.touchTimer+=a},dineInProcess:function(){a(".btn-cancel-dine-in, .btn-cancel").on("click",function(b){b.preventDefault(),void 0!=a("#form-input-order").get(0)&&a("#form-input-order").get(0).reset(),a("#form-input-order").find("textarea").val(""),a("#popup-customer-count").hide(),a(".popup-block").hide(),a(".btn-void-order").hide(),a("#input_void_note").val(""),a("#input_pin").val("")}),a(document).on("click",".get_menus",function(b){AppTable.loadingOverlay.show();var c=a(this).children(),d=a(this).attr("href"),e=a(this).data("category"),f=a("#menu-view-type").val(),g=a.ajax({type:"POST",url:d,data:{category_id:e,menu_type:f}});g.done(function(b){if(""!=b){var d=JSON.parse(b);a(".container-menus").html(d.content);var e=a("#btn-category-list").hasClass("active")?a(c[0]).text():a(c[1]).text();a(".category-name").text(""+e),AppTable.initListFilter(),AppTable.loadingOverlay.hide()}else window.location.reload(!0)}),g.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text())}),g.always(function(){}),b.preventDefault()});var b=0;a(document).on("click",".bill-table > tbody  > tr.tOrder",function(){b=setTimeout(AppTable.editOrderMenuDetail(a(this)),1e3)}).bind("mouseup mouseleave",function(){clearTimeout(b)});var c=0;/mobile|android/i.test(navigator.userAgent);a(document).on("mousedown click",".add-order-menu",function(b){if(b.preventDefault(),a(this).css("color","#333"),clearTimeout(c),AppTable.touchTimer<100){document.activeElement.blur(),"2"==AppTable.alreadyCompleted||"5"==AppTable.alreadyCompleted;var d=a(this).data("id"),e=a(this).data("name");if(AppTable.totalStockAvailable=parseInt(a(".total-available-"+d).html()),0==AppTable.totalStockAvailable&&"0"==a("#zero_stock_order").val())return a(this).css("color","red"),!1;a(".menu-name").text(e),a("#menu_id_selected").val(d),a("#is_already_process").val("0"),a(".btn-save").show(),AppTable.isEdit=!1,AppTable.getMenuDetail(d,!1,!1,this)}AppTable.touchTimer=0}),a(document).on("mousedown touchstart ",".add-order-menu",function(a){c=setTimeout(AppTable.startTouchTimer(50),50)}),a(".btn-save").off("click").on("click",function(b){b.preventDefault(),AppTable.loadingOverlay.show();var c=0,d=a(".count-order").val();if(AppTable.isEdit){c=a("#menu_order_id_selected").val();var e=parseInt(a("#temp_total_ordered").val())+AppTable.totalStockAvailable;if(parseInt(e)<parseInt(d)&&"0"==a("#zero_stock_order").val())return AppTable.alert("Jumlah pesanan melebihi stok."),!1;d-=a("#temp_total_ordered").val()}else if(c=a("#menu_id_selected").val(),AppTable.totalStockAvailable<parseInt(d)&&"0"==a("#zero_stock_order").val())return AppTable.alert("Jumlah pesanan melebihi stok."),!1;var f=a("#order_id").val(),g="",h="",i=a(".order-notes").val();a(".chk_dish:checked").each(function(){h+=a(this).val()+","}),h=h.slice(0,-1),a(".options :selected").each(function(b,c){g+=a(c).val()+","}),g=g.slice(0,-1),dinein_takeaway=a("#dinein_takeaway:checked").length>0?1:0;var j=a.ajax({type:"POST",url:AppTable.baseUrl+"table/save_order_menu",data:{menu_id:c,order_id:f,count:d,option:g,side_dish:h,notes:i,is_edit:AppTable.isEdit,is_take_away:a("#is_take_away").val(),is_delivery:a("#is_delivery").val(),outlet_id:a(".total-available-"+a("#menu_id_selected").val()).data("outlet"),dinein_takeaway:dinein_takeaway}});j.done(function(b){if(""!=b){var e=JSON.parse(b);if(e.status===!0){a(".bill-table tbody").html(e.order_list),a(".total-payment tbody").html(e.order_bill),AppTable.updateStockMenu(e.arr_menu_outlet);var f=0;0!=AppTable.totalStockAvailable&&(f=AppTable.totalStockAvailable-d),a(".total-available-"+c).html(f);var g=a("#delivery_cost_id").find("option:selected").data("is_percentage");1==g&&AppTable.updateDeliveryOrderCalc()}else""!=e.msg&&AppTable.alert(e.msg);a("#popup-customer-count").hide(),a(".popup-block").hide(),AppTable.isEdit=!1,AppTable.countOld="",a("#form-input-order").get(0).reset(),a("#form-input-order").find("textarea").val("")}AppTable.checkAllReady()}),j.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text())}),j.always(function(){AppTable.loadingOverlay.hide()})}),a("#btn-close-legend").on("click",function(){a("#legend").slideToggle("fast")}),a(".btn-delete-order").on("click",function(b){b.preventDefault();var c=a("#menu_order_id_selected").val(),d=a("#order_id").val(),e=a(".count-order").val();a("input[name='quantity-void']").attr("max",e);var f=a.ajax({type:"POST",url:AppTable.baseUrl+"table/delete_order_menu",data:{menu_id:c,order_id:d,count:a(".count-order").val()}});f.done(function(b){if(""!=b){var c=JSON.parse(b);c.status===!0&&(a(".bill-table tbody").html(c.order_list),a(".total-payment tbody").html(c.order_bill)),a("#popup-customer-count").hide(),a(".popup-block").hide(),a("#form-input-order").get(0).reset(),a("#form-input-order").find("textarea").val(""),AppTable.socket.emit("cm_notify_new_order",{arr_menu_outlet:c.arr_menu_outlet,room:"waiter"}),AppTable.updateStockMenu(c.arr_menu_outlet)}AppTable.checkAllReady()}),f.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),f.always(function(){})}),a(".btn-cancel-order").on("click",function(b){b.preventDefault();var c=a("#menu_order_id_selected").val(),d=a("#order_id").val(),e=a.ajax({type:"POST",url:AppTable.baseUrl+"table/update_cooking_status",data:{menu_id:c,order_id:d,cooking_status:4}});e.done(function(b){if(""!=b){var c=JSON.parse(b);c.status===!0&&(a(".bill-table tbody").html(c.order_list),a(".total-payment tbody").html(c.order_bill)),AppTable.socket.emit("cm_notify_new_order",{number_guest:c.number_guest,table_status:c.table_status,status_name:c.status_name,status_class:c.status_class,table_id:c.table_id,table_name:c.table_name,order_id:c.order_id,arr_merge_table:c.arr_merge_table,arr_menu_outlet:c.arr_menu_outlet,room:"waiter"}),AppTable.updateStockMenu(c.arr_menu_outlet),a(".popup-block").hide(),a("#form-input-order").get(0).reset(),a("#form-input-order").find("textarea").val("")}else window.location.reload(!0)}),e.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),e.always(function(){})}),a("input:radio[name=pinter_checker]").change(function(){var b=a.ajax({type:"POST",url:AppTable.baseUrl+"table/update_printer_checker_default",data:{printer_checker_selected:a(this).val()}});b.done(function(a){""!=a&&"0"!=a?console.log("success"):console.log("failed")}),b.fail(function(b,c){"timeout"==c&&console.log(a("#server-timeout-message p").text()),window.location.reload(!0)}),b.always(function(){})}),a("#btn-process-order").unbind("click").bind("click",function(b){b.preventDefault();var c=a(".bill-table > tbody  > tr").length;if(0==c)return AppTable.alert("Belum ada pesanan!"),!1;AppTable.loadingOverlay.show();var d=a("#order_id").val(),e=a(this).attr("href"),f=a.ajax({type:"POST",url:e,data:{order_id:d}});f.done(function(b){if(""!=b&&"0"!=b){var c=JSON.parse(b);if(AppTable.socket.emit("cm_notify_new_order",{number_guest:c.number_guest,table_status:c.table_status,status_name:c.status_name,status_class:c.status_class,table_id:c.table_id,table_name:c.table_name,order_id:c.order_id,arr_merge_table:c.arr_merge_table,floor_id:c.floor_id,room:"waiter",notification:c.notification,outlets:c.outlets}),1==AppTable.useKitchen){var d=a(".bill-table > tbody  > tr");d.each(function(){var b=a(this).find(".status_menu_order").html();if(b==all_cooking_status[0]){var b=a(this).find(".status_menu_order").html(all_cooking_status[1]),c=a(this).children();a(c[9]).text("1"),a(c[10]).text("1")}}),c.status_menu.forEach(function(b,c,d){a("#status_menu_"+b.id).html(b.cooking_status_name)})}else{var d=a(".bill-table > tbody  > tr");d.each(function(){var b=a(this).find(".status_menu_order").html();if("New"==b){var b=a(this).find(".status_menu_order").html("Ready"),c=a(this).children();a(c[9]).text("1"),a(c[10]).text("3")}}),c.status_menu.forEach(function(b,c,d){a("#status_menu_"+b.id).html(b.cooking_status_name)}),1==AppTable.useRoleChecker&&AppTable.socket.emit("cm_notify_checker",{})}AppTable.loadingOverlay.hide(),setTimeout(function(){window.location=c.url_redir},100)}else window.location.reload(!0)}),f.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),f.always(function(){})}),a(document).on("click","#btn-checkout-order",function(b){b.preventDefault();var c=a(".bill-table > tbody  > tr").length;if(0==c)return AppTable.alert("Belum ada pesanan ! Silahkan pesan terlebih dahulu"),!1;var d=a(".bill-table > tbody  > tr"),e=0;if(d.each(function(){var b=a(this).find(".status_menu_order").html();return b==all_cooking_status[1]||b==all_cooking_status[3]||b==all_cooking_status[2]?void(e+=1):void 0}),0==e&&3!=AppTable.diningType)return AppTable.alert("Chekout gagal, silahkan periksa kembali status pesanan anda."),!1;AppTable.loadingOverlay.show();var f=a("#order_id").val(),g=a(this).attr("href"),h=a.ajax({type:"POST",url:g,data:{order_id:f,floor_id:a("#floor_id").val()}});h.done(function(a){if(""!=a&&"0"!=a){var b=JSON.parse(a);b.status===!1?(AppTable.alert(b.message),AppTable.loadingOverlay.hide()):(AppTable.socket.emit("cm_notify_new_order",{number_guest:b.number_guest,table_status:b.table_status,table_name:b.table_name,status_name:b.status_name,status_class:b.status_class,table_id:b.table_id,order_id:b.order_id,arr_merge_table:b.arr_merge_table,room:"waiter",warning_badge:b.warning_badge}),setTimeout(function(){window.location=b.url_redir},100))}else window.location.reload(!0)}),h.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),h.always(function(){})}),a(document).on("click","#btn-close-order",function(a){a.preventDefault(),AppTable.confirm("Apakah orderan ini sudah selesai?",AppTable.closingOrder)}),a(document).on("click","#btn-pending-bill",function(b){b.preventDefault();var c=a(".bill-table > tbody  > tr").length;if(0==c)return AppTable.alert("Belum ada pesanan! Silahkan pesan terlebih dahulu"),!1;AppTable.loadingOverlay.show();var d=a("#order_id").val(),e=a(this).attr("href"),f=a.ajax({type:"POST",url:e,data:{order_id:d}});f.done(function(a){AppTable.loadingOverlay.hide()}),f.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),f.always(function(){})}),a(document).on("click","#btn-back-order",function(b){b.preventDefault(),AppTable.loadingOverlay.show();var c=a("#order_id").val(),d=a(this).attr("href"),e=a.ajax({type:"POST",url:d,data:{order_id:c}});e.done(function(a){var b=JSON.parse(a);AppTable.socket.emit("cm_notify_new_order",{table_status:b.table_status,status_name:b.status_name,status_class:b.status_class,table_id:b.table_id,table_name:b.table_name,order_id:b.order_id,arr_merge_table:b.arr_merge_table,room:"waiter",warning_badge:b.warning_badge}),setTimeout(function(){window.location=b.url_redir},100)}),e.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),e.always(function(){})}),a(document).on("click","#btn-reset-order",function(b){function c(){AppTable.loadingOverlay.show();var b=d.attr("href"),c=a("#order_id").val(),e=a.ajax({type:"POST",url:b,data:{order_id:c}});e.done(function(a){if(""!=a){var b=JSON.parse(a);b.status===!1?(AppTable.alert("Pesanan tidak dapat dihapus karena pesanan sudah diproses. Silahkan checkout pesanan terlebih dahulu!"),AppTable.loadingOverlay.hide()):(AppTable.socket.emit("cm_empty_table",{number_guest:b.number_guest,table_status:b.table_status,status_name:b.status_name,status_class:b.status_class,table_id:b.table_id,order_id:b.order_id,url_redir:b.url_redir,arr_merge_table:b.arr_merge_table,room:"waiter"}),setTimeout(function(){window.location=b.url_redir},100))}else window.location.reload(!0)}),e.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),e.always(function(){})}if(reservation_id=parseInt(a(this).data("reservation-id")),isNaN(reservation_id)&&(reservation_id=0),0!=reservation_id)return AppTable.alert("Order ini terkait dengan reservasi,silahkan delete di menu reservasi!"),!1;b.preventDefault();var d=a(this);AppTable.confirm("Anda yakin ingin reset order?",c)}),a("#btn-cancel-merge").on("click",function(b){function c(){url=object.attr("href"),console.log(url);var b=a.ajax({type:"GET",url:url});b.done(function(a){if(""!=a){var b=JSON.parse(a);AppTable.socket.emit("cm_cancel_merge",{ids:b.table_id}),AppTable.socket.emit("cm_empty_table",{number_guest:0,table_status:b.table_status,status_name:b.status_name,table_id:b.table_id,order_id:0,arr_merge_table:b.arr_merge_table,room:"waiter"}),setTimeout(function(){window.location=b.url_redir},100)}})}b.preventDefault(),object=a(this),AppTable.confirm("Anda yakin ingin membatalkan penggabungan meja?",c),console.log("ini loh")}),a("#btn-menu-list").on("click",function(b){a("#list-menu-text").show(),a("#thumb-menu-text").hide(),a("#menu-container").css({height:"100%","overflow-x":"hidden","overflow-y":"auto"}),a("#btn-menu-thumb").removeClass("active"),a("#btn-menu-list").addClass("active"),a("#menu-view-type").val("list")}),a("#btn-menu-thumb").on("click",function(b){a("#thumb-menu-text").show(),a("#list-menu-text").hide(),a("#menu-container").css({height:"100%","overflow-x":"hidden","overflow-y":"auto"}),a("#btn-menu-list").removeClass("active"),a("#btn-menu-thumb").addClass("active"),a("#menu-view-type").val("thumb")}),a("#btn-category-list").on("click",function(b){a("#list-category-text").show(),a("#thumb-category-text").hide(),a("#btn-category-thumb").removeClass("active"),a("#btn-category-list").addClass("active")}),a("#btn-category-thumb").on("click",function(b){a("#thumb-category-text").show(),a("#list-category-text").hide(),a("#btn-category-list").removeClass("active"),a("#btn-category-thumb").addClass("active")}),a("#btn-split-order").on("click",function(b){b.preventDefault();var c=a(".bill-table > tbody  > tr").length;return 2>c?(AppTable.alert("Membagi tagihan harus memesan menu lebih dari satu."),!1):(a(".split-block").show(),void AppTable.splitBillProcess())}),a("#btn-combine-order").on("click",function(b){b.preventDefault(),a(".combine-block").show();var c=a("#order_id").val(),d=a.ajax({type:"POST",url:AppTable.baseUrl+"table/get_order_combine",data:{order_id:c}});d.done(function(b){if(""!=b){var c=JSON.parse(b);a(".combine-order-table > tbody").html(c.data)}else window.location.reload(!0)}),d.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),d.always(function(){}),a(".btn-save-combine").on("click",function(b){b.preventDefault();var e=a('input[name="combine-order"]:checked').val();d=a.ajax({type:"POST",url:AppTable.baseUrl+"table/save_order_combine",data:{order_id:c,destination_id:e}}),d.done(function(a){if(""!=a){var b=JSON.parse(a);console.log(b),0==b.number_guest&&AppTable.socket.emit("cm_empty_table",{number_guest:b.number_guest,table_status:b.table_status,status_name:b.status_name,status_class:b.status_class,table_id:b.table_id,order_id:b.order_id,url_redir:b.url_redir,arr_merge_table:b.arr_merge_table,room:"waiter"}),setTimeout(function(){window.location=b.url_redir},100)}else window.location.reload(!0)}),d.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),d.always(function(){})})}),a("#btn-table-list").on("click",function(b){var c=a.ajax({type:"POST",url:AppTable.baseUrl+"table/update_table_view",data:{view_type:"1"}});c.done(function(b){if(""!=b){JSON.parse(b)}else window.location.reload(!0);a("#table-view-list").show(),a("#table-parent").hide(),a("#btn-table-thumb").removeClass("active"),a("#btn-table-list").addClass("active"),a(".navigation-floor").hide()}),c.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),c.always(function(){})}),a("#btn-table-thumb").on("click",function(b){var c=a.ajax({type:"POST",url:AppTable.baseUrl+"table/update_table_view",data:{view_type:"2"}});c.done(function(b){if(console.log(b),""!=b){JSON.parse(b)}else window.location.reload(!0);a("#table-parent").show(),a("#table-view-list").hide(),a("#btn-table-list").removeClass("active"),a("#btn-table-thumb").addClass("active"),a(".navigation-floor").show()}),c.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)}),c.always(function(){})}),a(".btn-cancel-dine-in").on("click",function(b){b.preventDefault(),a("#form-input-order").get(0).reset(),a("#form-input-order").find("textarea").val(""),a(".split-block").hide(),a(".combine-block").hide(),a("#input_void_note").val("")})},resizePanel:function(){var b=a(".bill-theme-con").height(),c=a(".total-payment").height(),d=a("#paymentAmount").height();a("#table-bill-list-checkout").height(b-c-d)},editOrderMenuDetail:function(b){var c=b.children();a(".menu-name").text(a(c[1]).text()),a("#menu_id_selected").val(a(c[4]).text()),a("#menu_order_id_selected").val(a(c[8]).text()),a("#is_already_process").val(a(c[10]).text()),a("#temp_total_ordered").val(a(c[11]).text()),AppTable.totalStockAvailable=parseInt(a(".total-available-"+a(c[4]).text()).html()),AppTable.getMenuDetail(a(c[4]).text(),!0,c),AppTable.voidProcess(c),AppTable.transferProcess(c),AppTable.isEdit=!0},removeBadge:function(b){a("#tab_layout_"+b+" .badge-table").remove(),a("#list_layout_"+b+" .badge-table").remove(),a("#tab_layout_"+b+" .badge-table").data("parent-id",0),a("#list_layout_"+b+" .badge-table").data("parent-id",0)},removeChildBadge:function(b){a(b).each(function(){AppTable.removeBadge(a(this).data("table-id"))})},prependChildBadge:function(b,c){a(b).each(function(){AppTable.prependBadge(a(this).data("table-id"),c)})},prependBadge:function(b,c,d,e){AppTable.removeBadge(b);var f=a("#tab_layout_"+b),g='<div class="badge-table">'+c+"</div>";f.prepend(g);var h=a("#list_layout_"+b),i='<div class="badge-table-small">'+c+"</div>";h.prepend(i),d&&(f.removeClass().addClass(d),h.removeClass().addClass("table-list-text label-rect-"+e.status_name),f.attr("data-order-id",e.order_id),h.attr("data-order-id",e.order_id),f.attr("data-table-status",e.table_status),h.attr("data-table-status",e.table_status))},prependArrayBadge:function(b){var c=b.parent_name,d=b.parent_id,e=(b.status_class,b.order_id,b.arr_merge_table);if(null!=e)for(var f=0;f<e.length;f++)AppTable.prependBadge(e[f].id,c,e[f].status_class,b),a("#tab_layout_"+e[f].id).attr("data-parent-id",d),a("#list_layout_"+e[f].id).attr("parent-data-id",d)},prependWarning:function(b){a("#tab_layout_"+b).prepend('<div class="warning-table"></div>'),a("#list_layout_"+b).prepend('<div class="warning-table-small"></div>')},removeWarning:function(b){a("#tab_layout_"+b+" .warning-table").remove(),a("#list_layout_"+b+" .warning-table-small").remove()},prependArrayWarning:function(a){if(null!=a)for(var b=0;b<a.length;b++)AppTable.prependWarning(a[b].id)},removeArrayWarning:function(a,b){if(null!=a)for(var c=0;c<a.length;c++)AppTable.removeWarning(a[c].id)},getTableMergeChild:function(b){return a("#table-parent").find('[data-parent-id="'+b+'"]')},updateStockMenu:function(b){if("undefined"!=typeof b)for(var c=0;c<b.length;c++)a(".total-available-"+b[c].id).html(b[c].total_available)},getMenuDetail:function(b,c,d,e){var f=0;if(c&&(f=a(d[8]).text()),0==c&&void 0!=e&&0==parseInt(a(e).data("option-count"))&&0==parseInt(a(e).data("side-dish-count"))){parsedObject={options:"<h5 style='color:#898989'>Tidak ada opsi untuk menu ini</h5>",order_menu_data:[],side_dish:"<h5 style='color:#898989'>Tidak ada side dish untuk menu ini</h5>"},a(".side-dish").html(parsedObject.side_dish),a(".menu-option").html(parsedObject.options),a(".side-dish").parents(".dark-theme-con").css("height","198px"),a(".side-dish").parents("#form-input-order").find(".order-note").css("height","225px"),a(".side-dish").parents("#form-input-order").find(".popup-order-panel").css("height","310px"),0==a("#dinein_takeaway").length?a(".order-notes").css("height","162px"):a(".order-notes").css("height","126px"),a(".side-dish").parents("table:first").find("tr:eq(3)").hide(),a(".side-dish").parents("table:first").find("tr:eq(4)").hide(),a("#waiter_name_order_menu").html("").hide(),a(".order-notes").css("height","126px"),a("#menu_cooking_status").val("1"),a(".btn-delete-order").hide(),a(".btn-cancel-order").hide(),a(".btn-transfer-order").hide();var g=a("#status_menu_"+f).text();"Ready"==g&&(a(".btn-delete-order").hide(),a(".btn-cancel-order").hide(),a(".btn-save").hide()),a("#popup-new-order").show()}else{var h=a.ajax({type:"POST",url:AppTable.baseUrl+"table/get_menu_accessories",data:{menu_id:b,menu_order_id:f}});h.done(function(b){if(""!=b){var e=JSON.parse(b);a(".side-dish").html(e.side_dish),a(".menu-option").html(e.options),0==a(".side-dish tr").length?(a(".side-dish").parents(".dark-theme-con").css("height","198px"),a(".side-dish").parents("#form-input-order").find(".order-note").css("height","225px"),a(".side-dish").parents("#form-input-order").find(".popup-order-panel").css("height","310px"),0==a("#dinein_takeaway").length?a(".order-notes").css("height","162px"):a(".order-notes").css("height","126px"),a(".side-dish").parents("table:first").find("tr:eq(3)").hide(),a(".side-dish").parents("table:first").find("tr:eq(4)").hide()):(a(".side-dish").parents(".dark-theme-con").css("height","310px"),a(".side-dish").parents("#form-input-order").find(".order-note").css("height","auto"),a(".side-dish").parents("#form-input-order").find(".popup-order-panel").css("height","390px"),0==a("#dinein_takeaway").length?a(".order-notes").css("height","274px"):a(".order-notes").css("height","238px"),a(".side-dish").parents("table:first").find("tr:eq(3)").show(),a(".side-dish").parents("table:first").find("tr:eq(4)").show()),a("#waiter_name_order_menu").html("").hide(),a(".order-notes").css("height","126px"),c?(a("#waiter_name_order_menu").html("Waiter : "+e.order_menu_data.waiter_name).show(),a(".order-notes").css("height","90px"),"1"==a(d[12]).text()?a("#dinein_takeaway").attr("checked","checked"):a("#dinein_takeaway").removeAttr("checked"),a(".count-order").val(a(d[2]).text()),a(".order-notes").val(a(d[5]).text()),a("#menu_cooking_status").val(a(d[9]).text()),"1"==a(d[10]).text()||"2"==AppTable.alreadyCompleted||"5"==AppTable.alreadyCompleted?(a(".btn-delete-order").hide(),a(".btn-save").hide(),"0"==a(d[9]).text()||"6"==a(d[9]).text()||"4"==a(d[9]).text()?(a(".btn-delete-order").show(),a(".btn-save").show(),a(".btn-void-order").hide()):a(".btn-cancel-order").hide()):(a(".btn-delete-order").show(),a(".btn-save").show(),a(".btn-cancel-order").hide(),("0"==a(d[9]).text()||"6"==a(d[9]).text()||"4"==a(d[9]).text())&&a(".btn-void-order").hide(),"4"==a(d[9]).text()&&a(".btn-save").hide())):(a("#menu_cooking_status").val("1"),a(".btn-delete-order").hide(),a(".btn-cancel-order").hide(),a(".btn-transfer-order").hide());var g=a("#status_menu_"+f).text();"Ready"==g&&(a(".btn-delete-order").hide(),a(".btn-cancel-order").hide(),a(".btn-save").hide()),a("#popup-new-order").show()}else window.location.reload(!0)}),h.fail(function(a,b){}),h.always(function(){})}},splitBillProcess:function(){var b=a.ajax({type:"POST",url:AppTable.baseUrl+"table/get_list_order",data:{order_id:a("#order_id").val()}});b.done(function(b){var c=JSON.parse(b);console.log(c),a(".split-order-table tbody").html(c.order_list),a(document).on("click",".btn-number",function(b){b.preventDefault();var c=a(this).attr("data-field"),d=a(this).attr("data-type"),e=a(this).siblings("input[name='"+c+"']"),f=parseInt(a(this).attr("max"));isNaN(f)&&(f=0);var g=parseInt(e.val()),h=c.split("-");h=h[1],opositeType="minus"==d?"plus":"minus";var i=a(this).siblings("input[name='"+opositeType+"-"+h+"']"),j=parseInt(i.val());isNaN(g)?e.val(1):g<e.attr("max")&&(e.val(g+1).change(),i.val(j-1).change())})})},reservationProcess:function(){a(".btn-reserv-come").on("click",function(b){var c=a(this).attr("data-status"),d=a(this).attr("reservation_id");a("#reservation_status").val(c),a("#popup-block-reservation-detail").hide(),a("#popup-customer-count").find(".reservation-active").removeClass("reservation-active"),a("#popup-customer-count").attr("reservation_id",d),a("#popup-customer-count").show();var e=(a(".new_order"),a("#reserved_customer_count").val());a(".new_order").each(function(){return parseInt(a(this).attr("data-guest"))==e?void a(this).addClass("reservation-active"):void 0})}),a(".btn-save-replace-reserv").unbind("click").bind("click",function(b){b.preventDefault();var c=a(this).attr("data-status");a("#reservation_status").val(c);var d=a.ajax({type:"POST",url:AppTable.baseUrl+"table/update_reservation_status",data:{reservation_id:a("#reservation_id").val(),status:c,note:a("#form-reservation-note").serialize()}});d.done(function(b){var d=JSON.parse(b);if(1==d.status){a("#popup-block-reservation-detail").hide(),a("#popup-reservation-note").hide(),console.log(d);var e=a("#tab_layout_"+d.table_id);""!=d.status_class&&e.removeClass().addClass(d.status_class),e.data("table-status",d.table_status),e=a("#list_layout_"+d.table_id),e.removeClass(),e.addClass("table-list-text label-rect-"+d.status_name),e.data("table-status",d.table_status),"4"==c?(console.log(e.data("table-status")),a("#popup-customer-count").removeAttr("reservation_id"),a("#popup-customer-count").show()):AppTable.socket.emit("cm_empty_table",{table_status:d.table_status,status_name:d.status_name,status_class:d.status_class,table_id:d.table_id,room:"waiter"})}else AppTable.alert(d.msg)}),d.fail(function(){})}),a("#btn-reserv-replace, #btn-reserv-delete").on("click",function(b){if("btn-reserv-delete"==a(this).attr("id")&&(user_confirmation=a(this).attr("feature_confirmation"),
void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation))return AppNav.showConfirmationPIN(user_confirmation,"#btn-reserv-delete","click",1),!1;var c=a(this).attr("data-status"),d="";a("#reservation_status").val(c),d="3"==c?"Hapus Status Reserved":"Isi Dengan Tamu Lain",a(".btn-save-replace-reserv").attr("data-status",c);var e=a.ajax({type:"POST",url:AppTable.baseUrl+"table/get_reserved_note",data:{}});e.done(function(b){if(""!=b){var c=JSON.parse(b);a("#popup-reservation-note").show(),a("#reservation-note").html(c.msg),a("#popup-reservation-note").find(".title-name").text(d)}else window.location=AppTable.baseUrl;AppTable.reservationProcess()})}),a("#btn-reserv-unlock").on("click",function(b){if(user_confirmation=a(this).attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation)return void AppNav.showConfirmationPIN(user_confirmation,"#btn-reserv-unlock","click",1);var c=a(this).attr("data-status"),d=a(this).attr("data-reservation_id");a("#reservation_status").val(c);var e=a.ajax({type:"POST",url:AppTable.baseUrl+"table/unlock_reserved",data:{reservation_id:d}});e.done(function(a){window.location.reload()}),e.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text()),window.location.reload(!0)})})},startRequestVoid:function(b,c){AppTable.loadingOverlay.show(),user_unlock_void=a("#user_unlock_void").length>0?a("#user_unlock_void").val():"",void 0==user_unlock_void&&(user_unlock_void="");var d=a.ajax({type:"POST",url:AppTable.baseUrl+"table/void_order_menu",data:{order_menu_id:c,table_id:a("#table_id").val(),order_id:b,count:a("#input_void_count").val(),is_decrease_stock:a("#is_decrease_stock").is(":checked"),input_void_note:a("#input_void_note").val(),user_unlock_void:user_unlock_void}});d.done(function(b){if(""!=b){var c=JSON.parse(b);1==c.status?(a(".bill-table tbody").html(c.order_list),a(".total-payment tbody").html(c.order_bill),a("#popup-customer-count").hide(),a(".popup-block").hide(),AppTable.socket.emit("cm_notify_new_order",{arr_menu_outlet:c.arr_menu_outlet,table_status:c.table_status,status_name:c.status_name,status_class:c.status_class,table_name:c.table_name,table_id:c.table_id,order_id:c.order_id,arr_merge_table:c.arr_merge_table,room:"waiter",outlets:c.outlets}),AppTable.updateStockMenu(c.arr_menu_outlet),a(".btn-void-order").hide()):AppTable.alert(c.msg),AppTable.checkAllReady(),AppTable.loadingOverlay.hide()}else window.location.reload(!0)}),d.fail(function(b,c){"timeout"==c&&AppTable.alert(a("#server-timeout-message p").text())})},initKeyboard:function(){var b=/mobile|android/i.test(navigator.userAgent);b||(a(".form-keyboard").keyboard({layout:"custom",customLayout:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {left} {right}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {left} {right}"]},restrictInput:!1,preventPaste:!0,autoAccept:!1,lockInput:!1}),console.log("KEYBOARD INIT"))},mergeTableProcess:function(b){var c=AppTable.getTableMergeChild(b),d=a("#tab_layout_"+AppTable.firstTableId),e=0;if(0==AppTable.isSelectTableFirst&&(AppTable.firstTableId!=b&&(e=parseInt(a(".dine-in-order[data-table-id='"+AppTable.firstTableId+"']").data("connect_to_reservation"))),0==e&&c.length>0&&a(c).each(function(){0==e&&a(this).data("table-id")!=b&&(e=parseInt(a(this).data("connect_to_reservation")))}),0==e&&AppTable.arrMergeTable.length>0&&AppTable.arrMergeTable.forEach(function(c){0==e&&c!=b&&(e=parseInt(a(".dine-in-order[data-table-id='"+c+"']").data("connect_to_reservation")))})),check_this_reservation_count=parseInt(a(".dine-in-order[data-table-id='"+b+"']").data("connect_to_reservation")),e>0&&check_this_reservation_count>0)return AppTable.alert("Meja yang terkait dengan reservasi tidak boleh lebih dari 1 data!"),!1;if(AppTable.isSelectTableFirst)AppTable.firstTableId=b,AppTable.isSelectTableFirst=!1,d=a("#tab_layout_"+b),AppTable.prependBadge(AppTable.firstTableId,d.data("table-name")),c.length>0&&a(c).each(function(){AppTable.prependBadge(a(this).data("table-id"),d.data("table-name")),AppTable.arrMergeTable.push(a(this).data("table-id"))});else{var f=AppTable.arrMergeTable.indexOf(b);-1==f&&AppTable.firstTableId!=b?(console.log("1"),AppTable.arrMergeTable.push(b),AppTable.removeBadge(b),c.length>0&&a(c).each(function(){AppTable.prependBadge(a(this).data("table-id"),d.data("table-name")),AppTable.arrMergeTable.push(a(this).data("table-id"))}),AppTable.prependBadge(b,d.data("table-name")),console.log(AppTable.arrMergeTable)):b!=AppTable.firstTableId?(console.log("2"),a("#tab_layout_"+b+" .badge-table").remove(),a(c).each(function(){var b=AppTable.arrMergeTable.indexOf(a(this).data("table-id"));AppTable.removeBadge(a(this).data("table-id")),AppTable.arrMergeTable.splice(b,1)}),AppTable.arrMergeTable.splice(f,1)):0==AppTable.arrMergeTable.length?(console.log("3"),a("#tab_layout_"+AppTable.firstTableId+" .badge-table").remove(),AppTable.isSelectTableFirst=!0):console.log("4")}},checkPrevNextFloor:function(){var b=parseInt(a("#floor_id").val()),c=parseInt(a(".floor-list li:first-child > a").data("id")),d=parseInt(a(".floor-list li:last-child > a").data("id"));a(".btn-change-floor").removeClass("disabled-floor"),b==c&&a(".btn-prev.btn-change-floor").addClass("disabled-floor"),b==d&&a(".btn-next.btn-change-floor").addClass("disabled-floor")},formatDeliveryCost:function(a,b){return a=parseFloat(a).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1."),a=a.slice(0,-3),b?a+="%":a="Rp "+a,a},updateDeliveryOrderCalc:function(){var b=a("#order_id").val(),c=a("#delivery_cost_id").find("option:selected").val(),d=a("#delivery_cost_id").find("option:selected").data("delivery_cost");void 0==d&&(d=0),a.ajax({url:AppTable.baseUrl+"cashier/save_delivery_cost_order",type:"POST",data:{order_id:b,delivery_cost_id:c,delivery_cost:d},dataType:"JSON",success:function(b){void 0!=b.data.order_bill&&(console.log(b.data.order_bill),a("#order_delivery_v_html .total-payment tbody").html(b.data.order_bill))}})}}});