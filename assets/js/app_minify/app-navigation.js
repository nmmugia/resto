define(["jquery","jquery-ui","bootstrap","bootstrapToggle"],function(a,b){return{nodeUrl:a("#node_url").val(),baseUrl:a("#base_url").val(),openCloseStatus:a("#open_close_status").val(),closeOverlay:a("#cover_close"),pageWrapper:a("#inner_container"),popupOpenClose:a("#popup-open-close"),inputPin:a("#pin_input"),init:function(){a('[data-tooltip="tooltip"]').tooltip(),a("#openCloseToggle").bootstrapToggle(),AppNav.baseUrl=a("#base_url").val(),AppNav.closeOverlay.show(),1==AppNav.openCloseStatus||(AppNav.pageWrapper.css("visibility","hidden"),AppNav.popupOpenClose.show()),AppNav.closeOverlay.hide();window.location.href;a(".icon-bar").each(function(){for(var b=a(this).children(),c=b.length-1;c>=0;c--)if("active"==a(b[c]).attr("data-active"))return void a(b[c]).addClass("active")}),a(".btn-pin").prop("disabled",!1),a(".btn-open").prop("disabled",!1),a("#popup-feature-confirmation button[data-value]").on("click",function(){inputPinConfirmation=a("#popup-feature-confirmation .input-pin"),textInput=a(this).text(),inputPinConfirmation.val(inputPinConfirmation.val()+textInput)}),a("#btn-feature-confirmation-clear").on("click",function(){inputPinConfirmation=a("#popup-feature-confirmation .input-pin"),inputPinConfirmation.val("")}),a("#btn-feature-confirmation-ok").on("click",function(){inputPinConfirmation=a("#popup-feature-confirmation .input-pin").val(),feature_confirmation=a("#popup-feature-confirmation").attr("feature_confirmation"),element=a("#popup-feature-confirmation").attr("element"),event_name=a("#popup-feature-confirmation").attr("event_name"),not_firing=a("#popup-feature-confirmation").attr("not_firing"),a.ajax({url:AppNav.baseUrl+"login/check_feature_confirmation",type:"POST",dataType:"JSON",data:{pin:inputPinConfirmation,users_unlock:feature_confirmation},success:function(b){1==b.status?(a(element).attr("feature_confirmation",""),a("#popup-feature-confirmation .input-pin").val(""),a("#popup-feature-confirmation").attr("feature_confirmation",""),a("#popup-feature-confirmation").attr("element",""),a("#popup-feature-confirmation").attr("event_name",""),a("#popup-feature-confirmation").attr("not_firing",""),a("#popup-feature-confirmation").hide(),"#split-single-right"==element?a("#split-single-left").attr("feature_confirmation",""):"#split-single-left"==element?a("#split-single-right").attr("feature_confirmation",""):".btn-void-order"==element?(0==a("#user_unlock_void").length&&a("body").prepend("<input type='hidden' id='user_unlock_void'>"),a("#user_unlock_void").val(b.data.id)):"#member-payment"==element&&(0==a("#user_unlock_member_bill").length&&a("body").prepend("<input type='hidden' id='user_unlock_member_bill'>"),a("#user_unlock_member_bill").val(b.data.id)),1==not_firing&&(a(element).hasClass("delete_order_all")?a(element).attr("skip_confirm",!0):setTimeout(function(){a(element).attr("feature_confirmation",feature_confirmation)},100),a(element).trigger(event_name))):AppNav.alert("PIN salah!")}})}),a("#btn-feature-confirmation-cancel").on("click",function(b){a("#popup-feature-confirmation").hide()}),AppNav.openCloseProcess(),AppNav.initFeatureConfirmation()},initFeatureConfirmation:function(){a(".menu_petty_cash").on("click",function(b){user_confirmation=a(this).attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation?(b.preventDefault(),AppNav.showConfirmationPIN(user_confirmation,".menu_petty_cash","click",1)):window.location.href=a(this).attr("href")}),a(".menu_refund").on("click",function(b){return user_confirmation=a(this).attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation?(AppNav.showConfirmationPIN(user_confirmation,".menu_refund","click",1),!1):void(window.location.href=a(this).attr("href"))}),a(".menu_report").on("click",function(b){if(b.preventDefault(),user_confirmation=a(this).attr("feature_confirmation"),void 0==user_confirmation&&(user_confirmation=""),""!=user_confirmation)return AppNav.showConfirmationPIN(user_confirmation,".menu_report","click",1),!1;var c=a(".popup-sales-report"),d=a.ajax({type:"POST",url:AppNav.baseUrl+"cashier/get_sales_today"});d.done(function(a){if(""!=a){var b=JSON.parse(a),d=b.summary,e=b.total_cash,f=b.total_debit,g=b.total_credit;c.find("#sum_total_price").html(AppNav.moneyFormat(null!=d.total_sell?parseInt(d.total_sell):0,"Rp")),c.find("#total_cash").html(AppNav.moneyFormat(null!=e.sum_total_price?parseInt(e.sum_total_price):0,"Rp")),c.find("#total_transaction").html(parseInt(d.total_transaction)),c.find("#total_debit").html(AppNav.moneyFormat(null!=f.sum_total_price?parseInt(f.sum_total_price):0,"Rp")),c.find("#total_customer_count").html(parseInt(d.total_customer_count)),c.find("#total_credit").html(AppNav.moneyFormat(null!=g.sum_total_price?parseInt(g.sum_total_price):0,"Rp")),c.find("#total_quantity_order").html(parseInt(d.total_quantity_order)),c.find("#total_discount").html(AppNav.moneyFormat(null!=d.total_discount?parseInt(d.total_discount):0,"Rp")),c.find("#total_count_voucher").html(parseInt(d.total_count_voucher)),c.find("#total_tax").html(AppNav.moneyFormat(null!=d.total_tax?parseInt(d.total_tax):0,"Rp")),c.show()}}),d.fail(function(b,c){"timeout"==c&&AppNav.alert(a("#server-timeout-message p").text()),window.location.reload(!0)})})},showConfirmationPIN:function(b,c,d,e){void 0==e&&(e=0),a("#popup-feature-confirmation").attr("feature_confirmation",b),a("#popup-feature-confirmation").attr("element",c),a("#popup-feature-confirmation").attr("event_name",d),a("#popup-feature-confirmation").attr("not_firing",e),a("#popup-feature-confirmation").show()},openCloseProcess:function(){a(".btn-cancel").on("click",function(b){a("#popup-openclose").hide()}),a(".btn-toggle-pin, .btn-toggle-openclose").on("click",function(b){a("#popup-openclose").show(),a("#openclose_begin_balance").val(a("#begin_balance_value").val())}),a("#openclose_begin_balance").on("focus",function(){}),a("#pin_input").on("focus",function(){AppNav.inputPin=a("#pin_input")});var b=/mobile|android/i.test(navigator.userAgent);b&&AppNav.inputPin.on("focus",function(){AppNav.inputPin.blur()}),AppNav.inputPin.on("keydown",function(b){-1!==a.inArray(b.keyCode,[46,8,9,27,13])||65==b.keyCode&&b.ctrlKey===!0||b.keyCode>=35&&b.keyCode<=39||(b.shiftKey||b.keyCode<48||b.keyCode>57)&&(b.keyCode<96||b.keyCode>105)&&b.preventDefault()}),AppNav.inputPin.keyup(function(b){13==b.keyCode&&a(".btn-enter").click()});var c=("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,"click");a(".btn-pin").on(c,function(){AppNav.inputPin.focus();var b=a(this).text();AppNav.inputPin.val(AppNav.inputPin.val()+b)}),a(".btn-clear").on(c,function(){AppNav.inputPin.val(""),AppNav.inputPin.focus()}),a("#btn-enter-open").on(c,function(){if(begin_balance=parseInt(a("#openclose_begin_balance").val()),cash_on_hand=parseFloat(a("#openclose_cash_on_hand").val()),isNaN(begin_balance)&&(begin_balance=0),isNaN(cash_on_hand)&&(cash_on_hand=0),1!=AppNav.openCloseStatus&&begin_balance<0)return void AppNav.alert("Saldo Awal harus >=0");var b=a.ajax({type:"POST",url:AppNav.baseUrl+"cashier/update_open_close",data:{cash_on_hand:cash_on_hand,begin_balance:begin_balance,pin:AppNav.inputPin.val(),status:AppNav.openCloseStatus}});b.done(function(a){if(""!=a){var b=JSON.parse(a);if(1==b.status){try{AppTable.socket.emit("cm_notify_open_close_cashier",{status:b.status})}catch(c){AppCashier.socket.emit("cm_notify_open_close_cashier",{status:b.status})}setTimeout(function(){window.location=b.url},100)}else AppNav.alert(b.msg)}else window.location.reload(!0)}),b.fail(function(b,c){"timeout"==c&&AppNav.alert(a("#server-timeout-message p").text()),window.location.reload(!0)})}),AppNav.inputPin.focus()},moneyFormat:function(a,b){return b+" "+a.toFixed(0).replace(/./g,function(a,b,c){return b>0&&","!==a&&(c.length-b)%3===0?"."+a:a})}}});