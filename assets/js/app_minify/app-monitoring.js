define(["jquery","jquery-ui","bootstrap","keyboard","datetimepicker","timepicker","qtip"],function(a,b){return{nodeUrl:a("#node_url").val(),baseUrl:a("#base_url").val(),socket:!1,loadingOverlay:a("#cover"),timeoutVal:1e4,numberOfData:a("#number_of_data").val(),perPage:a("#perPage").val(),selectedtableId:"",selectedorder_id:"",selectedreservation_id:"",order_menu_id:[],init:function(){AppMonitoring.loadingOverlay.show(),AppMonitoring.initFunc(AppMonitoring);try{AppMonitoring.initSocketIO()}catch(b){AppMonitoring.alert(a("#server-error-message p").text())}},initSocketIO:function(){AppMonitoring.socket=io(AppMonitoring.nodeUrl,{reconnectionAttempts:2}),AppMonitoring.socket.on("reconnect_failed",function(){AppMonitoring.alert(a("#server-error-message p").text()),window.location.reload(!0)}),AppMonitoring.socket.on("connected",function(b){console.log("Socket.IO connected"),AppMonitoring.socket.emit("cm_auth",{nip:AppMonitoring.userId,name:AppMonitoring.userName,role:AppMonitoring.groupId,role_name:AppMonitoring.groupName}),AppMonitoring.socket.on("sm_auth",function(a){AppMonitoring.loadingOverlay.hide(),AppMonitoring.initUIEvent()}),AppMonitoring.socket.on("sm_new_reservation",function(b){var c=parseInt(a("ul.pagination").find("li.active").text());(1==c||isNaN(c))&&(b.order_id<1?(console.log("order id"),AppMonitoring.addNewReservation(b)):AppMonitoring.addNewReservationOrder(b)),console.log(b)}),AppMonitoring.socket.on("sm_edit_reservation",function(a){console.log(a),a.order_id<1?AppMonitoring.editReservation(a):AppMonitoring.editReservationOrder(a)})})},initUIEvent:function(){a('[title!=""]').qtip(),a("#start_date").datetimepicker({sideBySide:!0,useCurrent:!0,format:"YYYY-MM-DD",widgetPositioning:{vertical:"bottom"}}),a("#start_date").on("dp.change",function(b){a("#to_date").datetimepicker({sideBySide:!0,useCurrent:!0,format:"YYYY-MM-DD"}),a("#to_date").data("DateTimePicker").minDate(b.date)}),a("#to_date").datetimepicker({sideBySide:!0,useCurrent:!0,format:"YYYY-MM-DD"}),a(document).on("click","#search_reservation",function(){start_date=a("#start_date input").val(),end_date=a("#to_date input").val(),a.ajax({url:AppMonitoring.baseUrl+"monitoring/search",data:{start_date:start_date,end_date:end_date},success:function(b){a("#content_monitoring").html(b)}})}),a(document).on("click","#today_reservation,#tommorow_reservation",function(){start_date=a(this).attr("date"),end_date=start_date,a("#start_date input").val(start_date).change(),a("#to_date input").val(end_date).change(),a.ajax({url:AppMonitoring.baseUrl+"monitoring/search",data:{start_date:start_date,end_date:end_date},success:function(b){a("#content_monitoring").html(b)}})}),a(document).on("click","#all_reservation",function(){a("#start_date input").val("").change(),a("#to_date input").val("").change(),a.ajax({url:AppMonitoring.baseUrl+"monitoring/search",data:{start_date:"",end_date:""},success:function(b){a("#content_monitoring").html(b)}})}),a(document).on("click","#pagination .pagination a",function(){var b=a(this).attr("href");return start_date=a("#start_date input").val(),end_date=a("#to_date input").val(),a.ajax({url:b,data:{start_date:start_date,end_date:end_date},success:function(b){a("#content_monitoring").html(b)}}),!1}),a(document).on("click",".print_list_menu",function(){order_id=a(this).attr("order-id"),AppMonitoring.loadingOverlay.show(),url=AppMonitoring.baseUrl+"monitoring/print_list_menu";a.ajax({type:"POST",url:url,timeout:AppMonitoring.timeoutVal,data:{order_id:order_id}});AppMonitoring.loadingOverlay.hide()}),a(document).off("click",".btn-mode2-post"),a(document).on("click",".btn-mode2-post",function(b){b.preventDefault();a(this).attr("url");AppMonitoring.selectedtableId=a(this).parents("li:first").find(".kitchen-table").attr("table-id"),AppMonitoring.selectedorder_id=a(this).parents("li:first").find(".kitchen-table").attr("order-id"),AppMonitoring.selectedreservation_id=a(this).parents("li:first").find(".kitchen-table").attr("reservation-id"),void 0==AppMonitoring.selectedreservation_id&&(AppMonitoring.selectedreservation_id=0);AppMonitoring.order_menu_id=[],a(this).parents("li:first").find(".kitchen-table tbody tr").each(function(b,c){AppMonitoring.order_menu_id.push(a(c).find("#menu_order_id").val())}),a("#confirm_post").show()}),a(document).off("click","#btn-ok-post"),a(document).on("click","#btn-ok-post",function(a){AppMonitoring.postReservation()}),a(document).off("click","#btn-cancel-post"),a(document).on("click","#btn-cancel-post",function(b){a("#confirm_post").hide()})},postReservation:function(){a("#confirm_post").hide(),AppMonitoring.loadingOverlay.show(),a.ajax({type:"POST",url:AppMonitoring.baseUrl+"monitoring/posts",data:{order_menu_id:AppMonitoring.order_menu_id,table_id:AppMonitoring.selectedtableId,order_id:AppMonitoring.selectedorder_id,reservation_id:AppMonitoring.selectedreservation_id}}).done(function(b){if(AppMonitoring.loadingOverlay.hide(),""!=b){var c=JSON.parse(b);1==c.status?(console.log(c),void 0!=c.table_id&&(tableId=c.table_id,console.log(tableId)),c.data.forEach(function(a,b){AppMonitoring.socket.emit("sm_notify_new_order",{order_menu_id:a.order_menu_id,cooking_status:a.cooking_status,status_name:a.status_name,table_id:tableId,order_id:a.order_id,arr_merge_table:a.arr_merge_table,notification:a.notification})}),c.outlets.length>0&&AppMonitoring.socket.emit("cm_notify_new_order",{order_id:AppMonitoring.selectedtableId,outlets:c.outlets}),AppMonitoring.socket.emit("cm_post_reservation",{table_status:4,order_id:AppMonitoring.selectedorder_id,table_id:AppMonitoring.selectedtableId,status_name:"waiting",reservation_id:AppMonitoring.selectedreservation_id,status_class:"dine-in-order label-rect-waiting"}),a("#reservation_"+AppMonitoring.selectedreservation_id).hide()):AppMonitoring.alert(c.message)}})},startTouchTimer:function(a){AppMonitoring.touchTimer+=a},addNewReservation:function(b){console.log(b);var c=parseInt(a("#number_of_data").val()),d=(parseInt(a("#perPage").val()),parseInt(a("ul.pagination").find("li.active").text())),e="",f="",g="";f=b.operator_name,f.length>15&&(f=f.substring(0,15)+"..."),g=b.customer_name,g.length>10&&(g=g.substring(0,15)+"..."),e='<li class="col-md-2" style="padding: 0px;margin-right:3px;width:16.4%" id="reservation_'+b.reservation_id+'">',e+='<div class="title-bg title-bg-kitchen" style="padding:0px;">',e+='<div class="col-md-12" style="padding:0px 0px 0px 2px;">',e+='<div class="left" style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;" title="'+b.operator_name+'">'+f+"</div>",e+='<div class="right" style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;">'+b.reservation_date+"</div>",e+='<div style="clear:both"></div>',e+='<div style="float:left;font-weight:bold;font-size: 29px;color:green;margin-right: 2px;line-height: 1;" title="'+b.table_number+'">'+b.table_number+"</div>",e+='<div class="left">',e+='<h4 class="title-name" style="color:#881817;margin: 0px;font-size: 12px;padding: 0px;text-align:left;" title="'+b.customer_name+'">'+b.customer_name+"</h4>",e+="</div>",e+='<button class="btn btn-option-list pull-right btn-mode2-post" style="margin-top: 0px;margin-left: 0px;font-size: 15px;font-weight: bold;line-height: 1;padding: 0px 5px;height: 29px;border-radius: 0px !important;">POST</button>',e+="</div>",e+="</div>",e+='<div class="dark-theme-con" style="overflow:auto;overflow-x:hidden;height:220px;padding-bottom:15px;">',e+='<table class="kitchen-table" table-id="'+b.table_id+'" order-id="'+b.order_id+'" reservation-id="'+b.reservation_id+'">',e+="<thead>",e+="<tr>",e+='<th style="width:90%;" colspan="2">MENU</th>',e+='<th style="width:10%;">JML</th>',e+="</tr>",e+="</thead>",e+="<tbody>",e+="</tbody>",e+="</table>",e+="</div>",e+="</li>",0==c?a(".list-order-kitchen").html(e):a(".list-order-kitchen").append(e);for(var h="",i=1;c>=i;i++)h=i==d?'<li class="active"><a href="javascript:void()"'+i+">"+i+"</a></li>":'<li><a href="'+AppMonitoring.baseUrl+"bosresto/monitoring/get_data/"+i+'">'+i+"</a></li>";a("#pagination").html(h),a("#number_of_data").val(c+1),AppMonitoring.initUIEvent()},addNewReservationOrder:function(b){var c=parseInt(a("#number_of_data").val()),d=(parseInt(a("#perPage").val()),parseInt(a("ul.pagination").find("li.active").text())),e="",f="",g="",h=b.detail_order[0];f=h.waiter_name,f.length>15&&(f=f.substring(0,15)+"..."),g=h.customer_name,g.length>10&&(g=g.substring(0,10)+"...");var e='<li class="col-md-2" style="padding: 0px;margin-right:3px;width:16.4%" id="reservation_'+b.reservation_id+'">';e+='<div class="title-bg title-bg-kitchen" style="padding:0px;">',e+='<div class="col-md-12" style="padding:0px 0px 0px 2px;">',e+='<div class="left" style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;" title="'+h.waiter_name+'">'+f+"</div>",e+='<div class="right" style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;">'+b.reservation_date+"</div>",e+='<div style="clear:both"></div>',e+='<div style="float:left;font-weight:bold;font-size: 29px;color:green;margin-right: 2px;line-height: 1;" title="'+h.table_name+'">'+h.table_name+"</div>",e+='<div class="left">',e+='<h4 class="title-name" style="color:#881817;margin: 0px;font-size: 12px;padding: 0px;text-align:left;" title="'+h.customer_name+'">'+g+"</h4>",e+='<div style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;" title="ORDER ID : "'+h.order_id+">"+h.order_id+"</div>",e+="</div>",e+='<button title="Print List Menu" class="btn btn-option-list pull-right print_list_menu" style="margin-top: 0px;margin-left:1px;font-size: 13px;font-weight: bold;line-height: 1;padding: 0px 5px;height: 29px;border-radius: 0px !important;" order-id="'+h.order_id+'"><i class="fa fa-print"></i></button>',e+='<button class="btn btn-option-list pull-right btn-mode2-post" style="margin-top: 0px;margin-left: 0px;font-size: 15px;font-weight: bold;line-height: 1;padding: 0px 5px;height: 29px;border-radius: 0px !important;">POST</button>',e+="</div>",e+="</div>",e+='<div class="dark-theme-con" style="overflow:auto;overflow-x:hidden;height:220px;padding-bottom:15px;">',e+='<table class="kitchen-table" table-id="'+h.table_id+'" order-id="'+h.order_id+'" reservation-id="'+h.reservation_id+'">',e+="<thead>",e+="<tr>",e+='<th style="width:90%;" colspan="2">MENU</th>',e+='<th style="width:10%;">JML</th>',e+="</tr>",e+="</thead>",e+="<tbody>";for(var i="",j=b.detail_order,k=17,l=0;l<j.length;l++){e+='<tr class="kitchen-order" process_checker="'+j[l].process_checker+'">',e+='<td style="color:'+j[l].color+"; ?>;background-color:"+j[l].background_color+'">',i="",j[l].note&&(i+=j[l].note+"<br> ");for(var m=j[l].option_list,n=0;n<m.length;n++)i+="- "+m[n].option_value_name+"<br>";for(var n=(j[l].side_dish_list,0);n<m.length;n++)i+="- "+m[n].name+"<br>";f.length>k&&(g=j[l].menu_name.substring(0,k)+"..."),e+='<span title="'+j[l].menu_name+'">'+j[l].menu_name+"</span>",e+="</td>",e+="<td>",i.length>0&&(e+='<div class="blink">',e+='<img src="'+AppMonitoring.baseUrl+'assets/img/notif.png" style="width: 9px;"/>',e+='<div class="popup-notes">'+i+"</div>",e+="</div>"),e+="</td>",e+='<td class="border-side-white">',e+="<center>"+j[l].quantity+"</center>",e+="</td>",e+='<input id="menu_order_id" type="hidden" value="'+j[l].id+'"/>',e+="</tr>"}e+="</tbody>",e+="</table>",e+="</div>",e+="</li>",0==c?a(".list-order-kitchen").html(e):a(".list-order-kitchen").append(e);for(var o="",l=1;c>=l;l++)o=l==d?'<li class="active"><a href="javascript:void()"'+l+">"+l+"</a></li>":'<li><a href="'+AppMonitoring.baseUrl+"bosresto/monitoring/get_data/"+l+'">'+l+"</a></li>";a("#pagination").html(o),a("#number_of_data").val(c+1),AppMonitoring.initUIEvent()},editReservation:function(b){console.log(b);var c=parseInt(a("#number_of_data").val()),d=(parseInt(a("#perPage").val()),parseInt(a("ul.pagination").find("li.active").text())),e="",f="",g="";f=b.operator_name,f.length>15&&(f=f.substring(0,15)+"..."),g=b.customer_name,g.length>10&&(g=g.substring(0,15)+"..."),e+='<div class="title-bg title-bg-kitchen" style="padding:0px;">',e+='<div class="col-md-12" style="padding:0px 0px 0px 2px;">',e+='<div class="left" style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;" title="'+b.operator_name+'">'+f+"</div>",e+='<div class="right" style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;">'+b.reservation_date+"</div>",e+='<div style="clear:both"></div>',e+='<div style="float:left;font-weight:bold;font-size: 29px;color:green;margin-right: 2px;line-height: 1;" title="'+b.table_number+'">'+b.table_number+"</div>",e+='<div class="left">',e+='<h4 class="title-name" style="color:#881817;margin: 0px;font-size: 12px;padding: 0px;text-align:left;" title="'+b.customer_name+'">'+b.customer_name+"</h4>",e+="</div>",e+='<button class="btn btn-option-list pull-right btn-mode2-post" style="margin-top: 0px;margin-left: 0px;font-size: 15px;font-weight: bold;line-height: 1;padding: 0px 5px;height: 29px;border-radius: 0px !important;">POST</button>',e+="</div>",e+="</div>",e+='<div class="dark-theme-con" style="overflow:auto;overflow-x:hidden;height:220px;padding-bottom:15px;">',e+='<table class="kitchen-table" table-id="'+b.table_id+'" order-id="'+b.order_id+'" reservation-id="'+b.reservation_id+'">',e+="<thead>",e+="<tr>",e+='<th style="width:90%;" colspan="2">MENU</th>',e+='<th style="width:10%;">JML</th>',e+="</tr>",e+="</thead>",e+="<tbody>",e+="</tbody>",e+="</table>",e+="</div>",a("#reservation_"+b.reservation_id).html(e);for(var h="",i=1;c>=i;i++)h=i==d?'<li class="active"><a href="javascript:void()"'+i+">"+i+"</a></li>":'<li><a href="'+AppMonitoring.baseUrl+"bosresto/monitoring/get_data/"+i+'">'+i+"</a></li>";a("#pagination").html(h),a("#number_of_data").val(c+1),AppMonitoring.initUIEvent()},editReservationOrder:function(b){var c=parseInt(a("#number_of_data").val()),d=(parseInt(a("#perPage").val()),parseInt(a("ul.pagination").find("li.active").text())),e="",f="",g="",h=b.detail_order[0];f=h.waiter_name,f.length>15&&(f=f.substring(0,15)+"..."),g=h.customer_name,g.length>10&&(g=g.substring(0,10)+"..."),e+='<div class="title-bg title-bg-kitchen" style="padding:0px;">',e+='<div class="col-md-12" style="padding:0px 0px 0px 2px;">',e+='<div class="left" style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;" title="'+h.waiter_name+'">'+f+"</div>",e+='<div class="right" style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;">'+b.reservation_date+"</div>",e+='<div style="clear:both"></div>',e+='<div style="float:left;font-weight:bold;font-size: 29px;color:green;margin-right: 2px;line-height: 1;" title="'+h.table_name+'">'+h.table_name+"</div>",e+='<div class="left">',e+='<h4 class="title-name" style="color:#881817;margin: 0px;font-size: 12px;padding: 0px;text-align:left;" title="'+h.customer_name+'">'+g+"</h4>",e+='<div style="color: #881817;text-transform: uppercase;font-weight: bold;font-size: 11px;" title="ORDER ID : "'+h.order_id+">"+h.order_id+"</div>",e+="</div>",e+='<button title="Print List Menu" class="btn btn-option-list pull-right print_list_menu" style="margin-top: 0px;margin-left:1px;font-size: 13px;font-weight: bold;line-height: 1;padding: 0px 5px;height: 29px;border-radius: 0px !important;" order-id="'+h.order_id+'"><i class="fa fa-print"></i></button>',e+='<button class="btn btn-option-list pull-right btn-mode2-post" style="margin-top: 0px;margin-left: 0px;font-size: 15px;font-weight: bold;line-height: 1;padding: 0px 5px;height: 29px;border-radius: 0px !important;">POST</button>',e+="</div>",e+="</div>",e+='<div class="dark-theme-con" style="overflow:auto;overflow-x:hidden;height:220px;padding-bottom:15px;">',e+='<table class="kitchen-table" table-id="'+h.table_id+'" order-id="'+h.order_id+'" reservation-id="'+h.reservation_id+'">',e+="<thead>",e+="<tr>",e+='<th style="width:90%;" colspan="2">MENU</th>',e+='<th style="width:10%;">JML</th>',e+="</tr>",e+="</thead>",e+="<tbody>";for(var i="",j=b.detail_order,k=17,l=0;l<j.length;l++){e+='<tr class="kitchen-order" process_checker="'+j[l].process_checker+'">',e+='<td style="color:'+j[l].color+"; ?>;background-color:"+j[l].background_color+'">',i="",j[l].note&&(i+=j[l].note+"<br> ");for(var m=j[l].option_list,n=0;n<m.length;n++)i+="- "+m[n].option_value_name+"<br>";for(var n=(j[l].side_dish_list,0);n<m.length;n++)i+="- "+m[n].name+"<br>";f.length>k&&(g=j[l].menu_name.substring(0,k)+"..."),e+='<span title="'+j[l].menu_name+'">'+j[l].menu_name+"</span>",e+="</td>",e+="<td>",i.length>0&&(e+='<div class="blink">',e+='<img src="'+AppMonitoring.baseUrl+'assets/img/notif.png" style="width: 9px;"/>',e+='<div class="popup-notes">'+i+"</div>",e+="</div>"),e+="</td>",e+='<td class="border-side-white">',e+="<center>"+j[l].quantity+"</center>",e+="</td>",e+='<input id="menu_order_id" type="hidden" value="'+j[l].id+'"/>',e+="</tr>"}e+="</tbody>",e+="</table>",e+="</div>",a("#reservation_"+b.reservation_id).html(e);for(var o="",l=1;c>=l;l++)o=l==d?'<li class="active"><a href="javascript:void()"'+l+">"+l+"</a></li>":'<li><a href="'+AppMonitoring.baseUrl+"bosresto/monitoring/get_data/"+l+'">'+l+"</a></li>";a("#pagination").html(o),a("#number_of_data").val(c+1),AppMonitoring.initUIEvent()}}});